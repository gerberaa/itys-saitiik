<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>TamagIRYS - –ì—Ä–∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --glass-bg: rgba(255,255,255,0.13);
      --glass-blur: 18px;
      --glass-border: rgba(255,255,255,0.25);
      --accent: #06EAD3;
      --accent2: #A4FEFD;
      --text-main: #fff;
      --text-soft: #A4FEFD;
      --shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, Arial, sans-serif;
      background: linear-gradient(120deg, #000000 100%, #000000 100%);
      color: var(--text-main);
      min-height: 100vh;
      box-sizing: border-box;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-bottom: 80px;
    }
    h1 {
      font-size: 2.2em;
      font-weight: 600;
      margin: 32px 0 24px 0;
      letter-spacing: 0.02em;
      color: var(--accent);
      text-shadow: none;
    }
    /* Glassmorphism block */
    .glass {
      background: var(--glass-bg);
      border-radius: 24px;
      box-shadow: var(--shadow);
      border: 1.5px solid var(--glass-border);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
    }
    /* HUD */
    #hud {
      position: fixed;
      top: 32px;
      left: 32px;
      min-width: 220px;
      padding: 24px 32px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      font-size: 1.1em;
      color: var(--text-main);
      z-index: 1002;
      font-weight: 500;
    }
    #hud .hud-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #hud .hud-label {
      color: var(--text-soft);
      font-weight: 400;
      min-width: 80px;
    }
    #hud .hud-value {
      color: var(--accent);
      font-weight: 600;
      font-size: 1.1em;
      background: rgba(255,255,255,0.22);
      border-radius: 8px;
      padding: 2px 14px;
      min-width: 60px;
      text-align: center;
      box-shadow: none;
    }
    /* –Ü–Ω–≤–µ–Ω—Ç–∞—Ä */
    .inventory-container {
      position: fixed;
      top: 32px;
      right: 32px;
      min-width: 320px;
      max-width: 420px;
      padding: 32px 32px 24px 32px;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 18px;
    }
    .inventory-container .expand-btn {
      position: absolute;
      top: 18px;
      left: 18px;
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.5em;
      cursor: pointer;
      z-index: 10;
      transition: color 0.2s;
      padding: 2px 8px;
    }
    .inventory-container .expand-btn:hover {
      color: var(--accent2);
    }
    .inventory-container.fullscreen {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 96vw;
      max-width: 700px;
      height: 90vh;
      min-width: 320px;
      max-height: 90vh;
      border-radius: 32px;
      padding: 0;
      z-index: 2000;
      background: #181c24;
      box-shadow: 0 12px 48px 0 rgba(31,38,135,0.25);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      overflow: hidden;
    }
    .inventory-container.fullscreen .inventory-header {
      width: 100%;
      background: #232946;
      border-top-left-radius: 32px;
      border-top-right-radius: 32px;
      padding: 24px 32px 18px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-sizing: border-box;
      box-shadow: 0 2px 12px 0 rgba(31,38,135,0.10);
    }
    .inventory-container.fullscreen .inventory-header h2 {
      margin: 0;
      font-size: 1.3em;
      color: var(--accent2);
      font-weight: 600;
      letter-spacing: 0.01em;
    }
    .inventory-container.fullscreen .expand-btn {
      position: static;
      color: #fff;
      background: none;
      border: none;
      font-size: 2em;
      cursor: pointer;
      padding: 0 8px;
      margin: 0;
      border-radius: 8px;
      transition: background 0.2s, color 0.2s;
    }
    .inventory-container.fullscreen .expand-btn:hover {
      background: #232946;
      color: var(--accent);
    }
    .inventory-container.fullscreen .inventory-list {
      flex: 1 1 0;
      width: 100%;
      max-height: unset;
      overflow-y: auto;
      padding: 24px 32px 24px 32px;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 18px;
      background: none;
    }
    .inventory-container.fullscreen .inventory-list li {
      background: #232946;
      border-radius: 18px;
      padding: 18px 18px 70px 70px;
      min-height: 90px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: 0 2px 8px 0 rgba(31,38,135,0.10);
      font-size: 1em;
      color: #fff;
      gap: 6px;
      overflow: hidden;
    }
    .inventory-container.fullscreen .inventory-list li .item-icon {
      position: absolute;
      left: 18px;
      top: 24px;
      width: 40px;
      height: 40px;
      background-size: contain;
      background-repeat: no-repeat;
      filter: drop-shadow(0 2px 8px rgba(6,234,211,0.12));
    }
    .inventory-container.fullscreen .inventory-list li .sell-btn {
      position: absolute;
      left: 18px;
      right: 18px;
      bottom: 18px;
      width: auto;
      margin: 0;
      padding: 14px 0;
      font-size: 1em;
      text-align: center;
      pointer-events: auto;
      z-index: 2;
      border-radius: 10px;
      background: var(--accent2);
      color: #181c24;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
      box-shadow: none;
      word-break: break-word;
      min-width: 80px;
      max-width: 100%;
    }
    .inventory-container.fullscreen .inventory-list li .sell-btn:hover {
      background: var(--accent);
      color: #fff;
    }
    @media (max-width: 700px) {
      .inventory-container.fullscreen {
        width: 99vw;
        max-width: 99vw;
        height: 98vh;
        max-height: 98vh;
        border-radius: 18px;
      }
      .inventory-container.fullscreen .inventory-header,
      .inventory-container.fullscreen .inventory-list {
        padding-left: 8px;
        padding-right: 8px;
      }
    }
    .inventory-container h2 {
      font-size: 1.3em;
      font-weight: 600;
      margin: 0 0 10px 0;
      color: var(--accent);
      letter-spacing: 0.01em;
    }
    .inventory-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 18px;
      max-height: 40vh;
      overflow-y: auto;
      padding: 0;
      margin: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--accent2) rgba(0,0,0,0.1);
    }
    .inventory-container.fullscreen .inventory-list {
      max-height: 70vh;
    }
    .inventory-list li {
      list-style: none;
      background: rgba(255,255,255,0.18);
      border-radius: 16px;
      padding: 12px 18px 56px 18px;
      color: var(--text-main);
      font-size: 1em;
      position: relative;
      min-height: 80px;
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      box-shadow: none;
      font-family: inherit;
      line-height: 1.5;
      letter-spacing: 0.01em;
      margin-bottom: 0;
      word-break: break-word;
      gap: 18px;
      overflow: hidden;
    }
    .inventory-list li .item-icon {
      flex: 0 0 40px;
      width: 40px;
      height: 40px;
      margin-top: 4px;
      background-size: contain;
      background-repeat: no-repeat;
      filter: drop-shadow(0 2px 8px rgba(6,234,211,0.12));
    }
    .inventory-list li .item-info {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      min-width: 0;
      position: relative;
      width: 100%;
    }
    .inventory-list li .item-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 100%;
      gap: 10px;
    }
    .inventory-list li .item-name {
      flex: 1 1 0;
      font-size: 1em;
      font-weight: 600;
      margin-bottom: 2px;
      display: block;
      word-break: break-word;
      min-width: 0;
    }
    .inventory-list li .item-actions {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
    }
    .inventory-list li .sell-btn {
      display: inline-block;
      min-width: 80px;
      max-width: 100%;
      margin: 0;
      padding: 8px 18px;
      font-size: 1em;
      text-align: center;
      pointer-events: auto;
      z-index: 2;
      border-radius: 10px;
      background: rgba(255,255,255,0.22);
      color: var(--accent);
      border: 1px solid var(--accent2);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
      box-shadow: none;
      word-break: break-word;
    }
    .inventory-list li .sell-btn:hover {
      background: var(--accent2);
      color: #fff;
    }
    .inventory-list li .rarity-badge {
      display: inline-block;
      font-size: 0.8em;
      font-weight: 500;
      border-radius: 6px;
      padding: 2px 10px;
      margin-bottom: 2px;
      margin-right: 8px;
      vertical-align: middle;
      color: #fff;
      background: linear-gradient(90deg, #FFD700 0%, #FFB300 100%);
      border: none;
    }
    .inventory-list li .rarity-badge.epic {
      background: linear-gradient(90deg, #a259f7 0%, #7b2ff2 100%);
    }
    .inventory-list li .rarity-badge.common {
      background: linear-gradient(90deg, #A4FEFD 0%, #06EAD3 100%);
      color: #0B0E26;
    }
    .inventory-list li .item-price {
      font-size: 0.9em;
      color: var(--accent2);
      margin-bottom: 2px;
      margin-right: 8px;
      vertical-align: middle;
      opacity: 0.8;
      font-weight: 500;
    }
    .inventory-list li.empty {
      text-align: center;
      color: #888;
      font-style: italic;
      background: none;
      box-shadow: none;
      padding-left: 0;
    }
    /* –ú–µ–Ω—é-–∫–Ω–æ–ø–∫–∏ */
    #menu {
      position: fixed;
      bottom: 24px;
      left: 0;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      z-index: 1100;
      pointer-events: none;
      gap: 12px;
      padding: 0 10vw;
      box-sizing: border-box;
      transition: opacity 0.2s;
    }
    #menu .icon-btn {
      background: var(--glass-bg);
      border: 2.5px solid var(--accent2);
      border-radius: 50%;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.6em;
      color: var(--accent);
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.18s, transform 0.13s;
      box-shadow: var(--shadow); /* –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É —Ç—ñ–Ω—å */
      outline: none;
      position: relative;
      margin: 0 8px;
      pointer-events: auto;
    }
    #menu .icon-btn:hover {
      background: var(--accent2);
      color: #fff;
      box-shadow: 0 0 40px 8px #A4FEFD, 0 8px 32px 0 rgba(6,234,211,0.18), 0 2px 0 #A4FEFD;
      transform: translateY(-4px) scale(1.12);
    }
    #menu .icon-btn:active {
      background: var(--accent);
      color: #fff;
      transform: scale(0.98);
      box-shadow: 0 0 18px 4px #06EAD3, 0 2px 8px 0 rgba(6,234,211,0.12), 0 1px 0 #06EAD3;
    }
    #menu .icon-btn svg {
      width: 48px;
      height: 48px;
      display: block;
    }
    #menu .icon-btn .emoji {
      font-size: 2em;
      line-height: 1;
    }
    .inventory-container.fullscreen ~ #menu {
      opacity: 0;
      pointer-events: none;
    }
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
    @media (max-width: 900px) {
      #hud {
        top: 10px;
        left: 10px;
        padding: 14px 10px;
      }
      .inventory-container {
        top: 10px;
        right: 10px;
        min-width: 180px;
        max-width: 95vw;
        padding: 14px 10px 10px 10px;
      }
      #menu {
        padding: 0 2vw;
      }
      #menu .icon-btn {
        font-size: 1.5em;
        width: 60px;
        height: 60px;
        margin: 0 4px;
      }
      #menu .icon-btn svg {
        width: 32px;
        height: 32px;
      }
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.1em;
        margin: 10px 0 10px 0;
      }
      #hud {
        min-width: 90px;
        padding: 8px 4px;
        top: 4px;
        left: 4px;
        font-size: 0.9em;
      }
      .inventory-container {
        min-width: 80px;
        max-width: 98vw;
        padding: 8px 2px 8px 2px;
        top: 4px;
        right: 4px;
      }
      .inventory-container.fullscreen {
        padding: 24px 2vw 24px 2vw;
      }
      #menu {
        bottom: 4px;
        padding: 0 1vw;
      }
      #menu .icon-btn {
        font-size: 1.1em;
        width: 44px;
        height: 44px;
        margin: 0 2px;
      }
      #menu .icon-btn svg {
        width: 22px;
        height: 22px;
      }
      .inventory-list li {
        font-size: 0.95em;
        min-height: 36px;
        padding: 10px 10px 10px 38px;
      }
      .inventory-list li .item-icon {
        width: 22px;
        height: 22px;
        left: 8px;
      }
    }
    /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏ */
    .equip-btn {
      display: inline-block;
      margin-top: 10px;
      margin-bottom: 0;
      margin-left: 0;
      padding: 8px 28px;
      font-size: 1em;
      border-radius: 22px;
      background: linear-gradient(90deg, #FFD700 0%, #FFB300 100%);
      color: #232946;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, box-shadow 0.18s;
      box-shadow: 0 2px 12px 0 rgba(255,215,0,0.18);
      min-width: 120px;
      max-width: 100%;
      text-align: center;
    }
    .equip-btn:hover {
      background: linear-gradient(90deg, #FFB300 0%, #FFD700 100%);
      color: #fff;
      box-shadow: 0 4px 18px 0 rgba(255,215,0,0.28);
    }
    .equip-btn.equipped {
      background: #bfc2c7;
      color: #232946;
      box-shadow: 0 2px 8px 0 rgba(100,100,100,0.10);
    }
    .equip-btn.equipped:hover {
      background: #a0a3a8;
      color: #fff;
    }
    .equip-btn:disabled {
      background: #bfc2c7;
      color: #232946;
      cursor: default;
      opacity: 0.8;
    }
    /* –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ñ –∑–∞ —Ä—ñ–¥–∫—ñ—Å—Ç—é */
    .market-legendary {
      border: 2.5px solid gold !important;
      box-shadow: 0 0 18px 2px gold !important;
      animation: gold-glow 1.5s infinite alternate;
    }
    .market-epic {
      border: 2.5px solid #a259f7 !important;
      box-shadow: 0 0 18px 2px #a259f7 !important;
      animation: epic-glow 1.5s infinite alternate;
    }
    .market-common {
      border: 2.5px solid #06EAD3 !important;
      box-shadow: 0 0 18px 2px #06EAD3 !important;
      animation: common-glow 1.5s infinite alternate;
    }
    @keyframes gold-glow {
      from { box-shadow: 0 0 8px 1px gold; }
      to { box-shadow: 0 0 24px 6px gold; }
    }
    @keyframes epic-glow {
      from { box-shadow: 0 0 8px 1px #a259f7; }
      to { box-shadow: 0 0 24px 6px #a259f7; }
    }
    @keyframes common-glow {
      from { box-shadow: 0 0 8px 1px #06EAD3; }
      to { box-shadow: 0 0 24px 6px #06EAD3; }
    }
    /* –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –ö—É–ø–∏—Ç–∏ */
    .buy-btn {
      background: linear-gradient(90deg, #06EAD3 0%, #A4FEFD 100%);
      color: #181c24;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      padding: 10px 28px;
      font-size: 1.08em;
      margin-left: 12px;
      cursor: pointer;
      box-shadow: 0 2px 12px 0 rgba(6,234,211,0.18);
      transition: background 0.18s, color 0.18s, box-shadow 0.18s, transform 0.13s;
      outline: none;
      position: relative;
      z-index: 1;
    }
    .buy-btn:hover:not(:disabled) {
      background: linear-gradient(90deg, #FFD700 0%, #FFB300 100%);
      color: #232946;
      box-shadow: 0 4px 18px 0 rgba(255,215,0,0.28);
      transform: scale(1.04);
    }
    .buy-btn:disabled {
      background: #bfc2c7;
      color: #232946;
      cursor: not-allowed;
      opacity: 0.7;
    }
    /* –ö–∞—Å—Ç–æ–º–Ω–∏–π tooltip –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é */
    .custom-tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 16px;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease, box-shadow 0.3s;
      box-shadow: 0 0 18px 4px #06EAD3, 0 0 8px 2px #A4FEFD;
      text-shadow: 0 0 8px #06EAD3, 0 0 2px #fff;
    }
    .custom-tooltip.active {
      opacity: 1;
      box-shadow: 0 0 32px 8px #06EAD3, 0 0 16px 4px #A4FEFD;
      text-shadow: 0 0 16px #06EAD3, 0 0 4px #fff;
    }
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      z-index: 10000;
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      animation: slideInDown 0.5s ease-out;
    }
    @keyframes slideInDown {
      from {
        transform: translateX(-50%) translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }
    .bubble {
      position: absolute;
      width: 32px;
      height: 32px;
      background: radial-gradient(circle at 30% 30%, #A4FEFD 80%, #06EAD3 100%, transparent 100%);
      border-radius: 50%;
      opacity: 0.7;
      pointer-events: none;
      animation: bubble-fly 1.2s linear forwards;
    }
    @keyframes bubble-fly {
      0% {
        opacity: 0.7;
        transform: scale(0.7) translate(0,0);
      }
      80% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
        transform: scale(1.2) translate(var(--tx, 0px), var(--ty, 0px));
      }
    }
    #marketplace-list {
      max-height: 50vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 0;
      margin: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--accent2) rgba(0,0,0,0.1);
    }
    #pet img {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }
    #blur-overlay {
      position: absolute;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      background: rgba(0,0,0,0.08);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      opacity: 0;
      transition: opacity 0.18s;
    }
    #blur-overlay.active {
      opacity: 1;
    }
    .rarity-badge.neon {
      background: linear-gradient(90deg, #00fff0 0%, #a259f7 100%);
      color: #fff;
      box-shadow: 0 0 12px 2px #00fff0, 0 0 24px 4px #a259f7;
      text-shadow: 0 0 8px #00fff0, 0 0 2px #fff;
    }
    .market-neon {
      border: 2.5px solid #00fff0 !important;
      box-shadow: 0 0 18px 2px #00fff0, 0 0 32px 8px #a259f7 !important;
      animation: neon-glow 1.5s infinite alternate;
    }
    @keyframes neon-glow {
      from { box-shadow: 0 0 8px 1px #00fff0; }
      to { box-shadow: 0 0 32px 8px #a259f7; }
    }
    @keyframes neon-pulse {
      from { box-shadow: 0 0 32px 8px #00fff0, 0 0 64px 16px #a259f7; }
      to { box-shadow: 0 0 64px 16px #00fff0, 0 0 128px 32px #a259f7; }
    }
  </style>
</head>
<body>
  <div id="blur-overlay"></div>
  <div style="display:flex; align-items:center; gap:18px; margin-top:32px;">
    <h1 style="margin:0;">TamagIRYS</h1>
    <div id="discord-user-info" style="display:none; background:rgba(0,0,0,0.18); border-radius:16px; padding:8px 18px; display:flex; align-items:center; gap:10px; position:static;">
      <img id="discord-avatar" src="" alt="avatar" style="width:32px; height:32px; border-radius:50%; background:#232946;">
      <span id="discord-username" style="color:var(--accent2); font-weight:600;"></span>
    </div>
  </div>
  <div id="hud" class="glass">
    <div class="hud-row"><span class="hud-label">‚ö°Ô∏è–ï–Ω–µ—Ä–≥—ñ—è</span><span class="hud-value" id="energy">100%</span></div>
    <div class="hud-row"><span class="hud-label">üåû–ù–∞—Å—Ç—Ä—ñ–π</span><span class="hud-value" id="mood">–©–∞—Å–ª–∏–≤–∏–π</span></div>
    <div class="hud-row"><span class="hud-label">üí•XP</span><span class="hud-value" id="xp">0</span></div>
    <div class="hud-row"><span class="hud-label">üíß–ß–∏—Å—Ç–æ—Ç–∞</span><span class="hud-value" id="cleanliness">–ß–∏—Å—Ç–æ</span></div>
    <div class="hud-row" style="margin-top:8px; color:var(--accent2); font-size:1.05em;">
      <span id="xp-per-train">+10 XP –∑–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</span>
    </div>
  </div>
  <div id="inventory" class="inventory-container glass">
    <div id="inventory-backdrop" class="inventory-fullscreen-backdrop" style="display:none;"></div>
    <div class="inventory-header" id="inventoryHeader" style="display:none;">
      <h2>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h2>
      <button class="expand-btn" id="expandInventoryBtn" title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏/–ó–≥–æ—Ä–Ω—É—Ç–∏ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä">‚úñ</button>
    </div>
    <ul id="inventory-list" class="inventory-list"></ul>
  </div>
  <div id="pet" style="margin-top: 120px; margin-bottom: 32px; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; background: none; box-shadow: none; border: none; position: relative;">
    <div id="blur-overlay"></div>
    <img id="pet-img" src="pet.png" alt="pet" style="width: 400px; height: 400px; border-radius: 0; box-shadow: none; object-fit: contain; background: none;">
    <div class="sparkles" id="pet-sparkles" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:2;">
      <svg width="100%" height="100%" viewBox="0 0 180 180">
        <g>
          <circle cx="40" cy="60" r="8" fill="#A4FEFD" opacity="0.8">
            <animate attributeName="r" values="8;16;8" dur="1.2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.8;0.2;0.8" dur="1.2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="120" cy="40" r="6" fill="#06EAD3" opacity="0.7">
            <animate attributeName="r" values="6;12;6" dur="1.1s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.7;0.2;0.7" dur="1.1s" repeatCount="indefinite"/>
          </circle>
          <circle cx="90" cy="120" r="10" fill="#fff" opacity="0.5">
            <animate attributeName="r" values="10;18;10" dur="1.3s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.5;0.1;0.5" dur="1.3s" repeatCount="indefinite"/>
          </circle>
        </g>
      </svg>
    </div>
    <div class="bubbles" id="pet-bubbles" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:3;"></div>
  </div>
  <div id="menu" class="menu">
    <button class="icon-btn" onclick="feedPet()" title="–ì–æ–¥—É–≤–∞—Ç–∏">
      <i class="bi bi-egg-fried"></i>
    </button>
    <button class="icon-btn" onclick="sleepPet()" title="–°–ø–∞—Ç–∏">
      <i class="bi bi-moon"></i>
    </button>
    <button class="icon-btn" onclick="cleanPet()" title="–ß–∏—Å—Ç–∏—Ç–∏">
      <i class="bi bi-droplet"></i>
    </button>
    <button class="icon-btn" onclick="trainPet()" title="–¢—Ä–µ–Ω—É–≤–∞—Ç–∏">
      <i class="bi bi-lightning"></i>
    </button>
    <button class="icon-btn" onclick="openInventory()" title="–Ü–Ω–≤–µ–Ω—Ç–∞—Ä">
      <i class="bi bi-bag"></i>
    </button>
    <button class="icon-btn" onclick="openMarketplace()" title="–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å"><i class="bi bi-archive"></i></button>
    <button class="icon-btn" onclick="openRulesModal()" title="–ü—Ä–∞–≤–∏–ª–∞ —ñ —Ü—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏"><i class="bi bi-asterisk"></i></button>
    <button class="icon-btn" onclick="openAuthorsModal()" title="–ê–≤—Ç–æ—Ä–∏"><i class="bi bi-balloon-heart"></i></button>
  </div>

  <!-- –í—ñ–∫–Ω–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—É -->
  <div id="marketplace-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.55); z-index:3000; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:600px; width:96vw; margin:auto; border-radius:24px; padding:32px 18px 24px 18px; position:relative;">
      <button onclick="closeMarketplace()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">‚úñ</button>
      <h2 style="color:var(--accent2); margin-top:0;">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</h2>
      <ul id="marketplace-list" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:18px;"></ul>
    </div>
  </div>

  <!-- –í—ñ–∫–Ω–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
  <div id="inventory-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.55); z-index:3000; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:700px; width:96vw; margin:auto; border-radius:24px; padding:32px 18px 24px 18px; position:relative; max-height:90vh; overflow-y:auto;">
      <button onclick="closeInventory()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">‚úñ</button>
      <h2 style="color:var(--accent2); margin-top:0;">üéí –Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h2>
      <div style="margin-bottom:20px; color:var(--text-soft);">
        <span id="inventory-count">–ü—Ä–µ–¥–º–µ—Ç—ñ–≤: 0</span>
      </div>
      <ul id="inventory-modal-list" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:18px;"></ul>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ Discord-–ª–æ–≥—ñ–Ω—É -->
  <div id="discord-login-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:5000; align-items:center; justify-content:center;">
    <div class="glass" style="padding:48px 32px; border-radius:24px; text-align:center; max-width:350px; width:90vw;">
      <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord" style="width:64px; height:64px; margin-bottom:18px;">
      <h2 style="color:var(--accent2); margin:0 0 18px 0;">–£–≤—ñ–π–¥—ñ—Ç—å —á–µ—Ä–µ–∑ Discord</h2>
      <p style="color:var(--text-soft); margin-bottom:24px;">–©–æ–± –≥—Ä–∞—Ç–∏, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—è —á–µ—Ä–µ–∑ Discord</p>
      <a href="/auth/discord" style="background:#5865F2; color:#fff; font-size:1.1em; border:none; border-radius:12px; padding:14px 32px; font-weight:700; cursor:pointer; text-decoration:none; display:inline-block;">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord</a>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª —ñ —Ñ–∞–∫—Ç—ñ–≤ -->
  <div id="rules-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.65); z-index:4000; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:700px; width:96vw; margin:auto; border-radius:24px; padding:36px 28px 28px 28px; position:relative; overflow-y:auto; max-height:90vh;">
      <button onclick="closeRulesModal()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">‚úñ</button>
      <h2 style="color:var(--accent2); margin-top:0;">üìö –ü—Ä–∞–≤–∏–ª–∞ —Ç–∞ —Ü—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏</h2>
      <div style="color:var(--text-main); font-size:1.08em; line-height:1.7;">
        <h3 style="color:var(--accent2); margin-top:20px;">üéÆ –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞:</h3>
        <ul>
          <li>–ì–æ–¥—É–π—Ç–µ IRYS —â–æ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –µ–Ω–µ—Ä–≥—ñ—é</li>
          <li>–ö–ª–∞–¥—ñ—Ç—å —Å–ø–∞—Ç–∏ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏–ª</li>
          <li>–ß–∏—Å—Ç—ñ—Ç—å IRYS —â–æ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –≥—ñ–≥—ñ—î–Ω—É</li>
          <li>–¢—Ä–µ–Ω—É–π—Ç–µ—Å—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è XP</li>
          <li>–î–æ—Å–ª—ñ–¥–∂—É–π—Ç–µ —Å–≤—ñ—Ç —â–æ–± –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–∏</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">üòä –ù–∞—Å—Ç—Ä—ñ–π IRYS:</h3>
        <ul>
          <li><strong>–©–∞—Å–ª–∏–≤–∏–π</strong> - IRYS –≥–æ—Ç–æ–≤–∞ –¥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—ñ—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</li>
          <li><strong>–°–æ–Ω–Ω–∏–π</strong> - –µ–Ω–µ—Ä–≥—ñ—è –Ω–∏–∑—å–∫–∞, —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ</li>
          <li><strong>–ü–æ–≥–∞–Ω–∏–π</strong> - IRYS –±—Ä—É–¥–Ω–∞, —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ</li>
          <li><strong>–î—É–∂–µ –ø–æ–≥–∞–Ω–∏–π</strong> - –Ω–∏–∑—å–∫–∞ –µ–Ω–µ—Ä–≥—ñ—è + –±—Ä—É–¥–Ω–æ, —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">‚ö° –í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–¥—ñ—ó:</h3>
        <ul>
          <li>–ü—Ä–∏ –∫–æ–∂–Ω—ñ–π –¥—ñ—ó —î 15% —à–∞–Ω—Å –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó –ø–æ–¥—ñ—ó</li>
          <li><strong>–ü–æ–∑–∏—Ç–∏–≤–Ω—ñ –ø–æ–¥—ñ—ó:</strong> –¥–æ–¥–∞—Ç–∫–æ–≤—ñ XP, –µ–Ω–µ—Ä–≥—ñ—è, –ø—Ä–µ–¥–º–µ—Ç–∏, –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –Ω–∞—Å—Ç—Ä–æ—é</li>
          <li><strong>–ù–µ–≥–∞—Ç–∏–≤–Ω—ñ –ø–æ–¥—ñ—ó:</strong> –ø–æ–≥—ñ—Ä—à–µ–Ω–Ω—è –Ω–∞—Å—Ç—Ä–æ—é, –≤—Ç—Ä–∞—Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó</li>
          <li>–ü–æ–¥—ñ—ó —Ä–æ–±–ª—è—Ç—å –≥—Ä—É –±—ñ–ª—å—à –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—é —Ç–∞ —Ü—ñ–∫–∞–≤–æ—é</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">üíé –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤:</h3>
        <ul>
          <li><strong>–ö–∞–º–æ–Ω–∫–∞</strong> - –∑–≤–∏—á–∞–π–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ (70% —à–∞–Ω—Å)</li>
          <li><strong>–ü—É—Ä–ø—É—Ä–Ω–∞</strong> - –µ–ø—ñ—á–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ (25% —à–∞–Ω—Å)</li>
          <li><strong>–ó–æ–ª–æ—Ç–∞</strong> - –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ (5% —à–∞–Ω—Å)</li>
          <li>–ú–æ–∂–Ω–∞ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏ –¥–æ 3 –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ</li>
          <li>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –¥–∞—é—Ç—å –±–æ–Ω—É—Å XP –∑–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">üè™ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å:</h3>
        <ul>
          <li>–ü—Ä–µ–¥–º–µ—Ç–∏ –∫–æ—à—Ç—É—é—Ç—å –≤ 10 —Ä–∞–∑—ñ–≤ –±—ñ–ª—å—à–µ –Ω—ñ–∂ —ó—Ö –±–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞</li>
          <li>–¶–µ —Å—Ç–∏–º—É–ª—é—î –∑–∞—Ä–æ–±–ª—è—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–∏ —á–µ—Ä–µ–∑ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è</li>
          <li>–ú–æ–∂–Ω–∞ –ø—Ä–æ–¥–∞–≤–∞—Ç–∏ –∑–∞–π–≤—ñ –ø—Ä–µ–¥–º–µ—Ç–∏</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">üéØ –ü–æ—Ä–∞–¥–∏ –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤:</h3>
        <ul>
          <li>–°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –Ω–∞—Å—Ç—Ä–æ—î–º IRYS - –≤—ñ–Ω –≤–ø–ª–∏–≤–∞—î –Ω–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ</li>
          <li>–¢—Ä–µ–Ω—É–π—Ç–µ—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ IRYS —â–∞—Å–ª–∏–≤–∞</li>
          <li>–ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å—É XP</li>
          <li>–í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–¥—ñ—ó –º–æ–∂—É—Ç—å —è–∫ –¥–æ–ø–æ–º–æ–≥—Ç–∏, —Ç–∞–∫ —ñ –∑–∞—à–∫–æ–¥–∏—Ç–∏</li>
          <li>–†–µ–≥—É–ª—è—Ä–Ω–æ –¥–æ—Å–ª—ñ–¥–∂—É–π—Ç–µ —Å–≤—ñ—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç—ñ–≤</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">üîó –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:</h3>
        <ul>
          <li><a href="https://discord.gg/irys" target="_blank" style="color:var(--accent2);">Discord —Å–µ—Ä–≤–µ—Ä IRYS</a></li>
          <li><a href="https://www.youtube.com/@IRyS" target="_blank" style="color:var(--accent2);">YouTube –∫–∞–Ω–∞–ª IRYS</a></li>
          <li><a href="https://twitter.com/irys_en" target="_blank" style="color:var(--accent2);">Twitter IRYS</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∞–≤—Ç–æ—Ä—ñ–≤ -->
  <div id="authors-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.65); z-index:4100; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:420px; width:92vw; margin:auto; border-radius:24px; padding:36px 28px 28px 28px; position:relative; overflow-y:auto; max-height:90vh; text-align:center;">
      <button onclick="closeAuthorsModal()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">‚úñ</button>
      <h2 style="color:var(--accent2); margin-top:0;">–ê–≤—Ç–æ—Ä –≥—Ä–∏</h2>
      <div style="color:var(--text-main); font-size:1.12em; line-height:1.7; margin-bottom:18px;">–¶–µ–π –ø—Ä–æ—î–∫—Ç —Å—Ç–≤–æ—Ä–∏–≤:</div>
      <div style="display:flex; flex-direction:column; align-items:center; gap:18px;">
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord" style="width:32px; height:32px;">
          <span style="font-weight:600; color:#A4FEFD;">@megymin</span>
        </div>
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733553.png" alt="GitHub" style="width:32px; height:32px;">
          <a href="https://github.com/gerberaa" target="_blank" style="color:#A4FEFD; font-weight:600; text-decoration:underline;">github.com/gerberaa</a>
        </div>
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram" style="width:32px; height:32px;">
          <a href="https://t.me/megymin_xz" target="_blank" style="color:#A4FEFD; font-weight:600; text-decoration:underline;">@megymin_xz</a>
        </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div id="custom-tooltip" class="custom-tooltip"></div>
  <div id="notification" class="notification" style="display: none;"></div>

  <script>
    let xp = 0;
    let inventory = {}; // {–Ω–∞–∑–≤–∞: –∫—ñ–ª—å–∫—ñ—Å—Ç—å}
    let equippedLegendaryItems = []; // –ú–∞—Å–∏–≤ –µ–∫—ñ–ø—ñ—Ä–æ–≤–∞–Ω–∏—Ö –∑–æ–ª–æ—Ç–∏—Ö —Ä–µ—á–µ–π
    let equippedItems = [];

    // --- –û–ø–∏—Å –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –∑ —Ä—ñ–¥–∫—ñ—Å—Ç—é —Ç–∞ —Ü—ñ–Ω–æ—é ---
    const itemData = [
      { name: 'NFT –®–∞–ø–∫–∞', rarity: 'common', price: 100, icon: 'asets/–®–∞–ø–∫–∞.png' },
      { name: 'NFT –°–æ–Ω—Ü–µ–∑–∞—Ö–∏—Å–Ω—ñ –æ–∫—É–ª—è—Ä–∏', rarity: 'epic', price: 499, icon: 'asets/–û–ß–ö–Ü.png' },
      { name: 'NFT –ö–æ—Å—Ç—é–º', rarity: 'legendary', price: 3000, icon: 'asets/–ö–û–°–¢–Æ–ú.png' },
      { name: 'NFT –ö—Ä–æ—Å—ñ–≤–∫–∏', rarity: 'common', price: 100, icon: 'asets/–ö–†–û–°–Ü–í–ö–ò –ô–û–£.png' },
      { name: 'NFT –ì–æ–¥–∏–Ω–Ω–∏–∫', rarity: 'epic', price: 499, icon: 'asets/–†–û–õ–Ü–ö–°–ò.png' },
      { name: 'NFT –†—é–∫–∑–∞–∫', rarity: 'common', price: 100, icon: 'asets/–†–Æ–ö–ó–ê–ö –ù–ê–•.png' },
      { name: 'NFT –ü–æ—è—Å', rarity: 'common', price: 100, icon: 'asets/–ü–û–Ø–°.png' },
      { name: 'NFT –ü–ª–∞—â', rarity: 'epic', price: 499, icon: 'asets/–ü–õ–ê–©.png' },
      { name: 'NFT –ö—É–ª–æ–Ω', rarity: 'legendary', price: 3000, icon: 'asets/–ö–£–õ–û–ù.png' },
      { name: 'NFT –ö–µ–ø–∫–∞', rarity: 'common', price: 100, icon: 'asets/–ö–ï–ü–ö–ê.png' },
      { name: 'NFT –ü–µ—Ä—Å—Ç–µ–Ω—å', rarity: 'epic', price: 499, icon: 'asets/–ü–ï–†–°–¢–ï–ù–¨.png' },
      { name: '–ì–∞–ª–∞–∫—Ç–∏—á–Ω–∞ NFT', rarity: 'neon', price: 1000000, icon: 'asets/galaxy.png' },
    ];
    const allItems = itemData.map(i => i.name);
    const itemMap = Object.fromEntries(itemData.map(i => [i.name, i]));

    function getRandomItem() {
      // –í–∏–ø–∞–¥–∞—Ç–∏ –º–æ–∂—É—Ç—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∏, –∫—Ä—ñ–º –ì–∞–ª–∞–∫—Ç–∏—á–Ω–∞ NFT
      const legendary = itemData.filter(i => i.rarity === 'legendary' && i.name !== '–ì–∞–ª–∞–∫—Ç–∏—á–Ω–∞ NFT');
      const epic = itemData.filter(i => i.rarity === 'epic');
      const common = itemData.filter(i => i.rarity === 'common');
      const rand = Math.random();
      if (rand < 0.05) { // 5% –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞
        return legendary[Math.floor(Math.random() * legendary.length)].name;
      } else if (rand < 0.25) { // 20% –µ–ø—ñ—á–Ω–∞
        return epic[Math.floor(Math.random() * epic.length)].name;
      } else { // 75% –∫–∞–º–æ–Ω–∫–∞
        return common[Math.floor(Math.random() * common.length)].name;
      }
    }

    function updateInventoryUI() {
      const list = document.getElementById('inventory-list');
      list.innerHTML = '';
      const items = Object.keys(inventory);
      if (items.length === 0) {
        const li = document.createElement('li');
        li.innerText = '–ü–æ—Ä–æ–∂–Ω—å–æ';
        li.className = 'empty';
        list.appendChild(li);
      } else {
        items.forEach((item) => {
          const data = itemMap[item];
          const li = document.createElement('li');
          if (data.rarity === 'legendary' && equippedLegendaryItems.includes(item)) {
            li.style.border = '2.5px solid gold';
            li.style.boxShadow = '0 0 16px 0 gold';
          }
          const icon = document.createElement('span');
          icon.className = 'item-icon';
          icon.style.backgroundImage = `url('${data.icon}')`;
          const info = document.createElement('div');
          info.className = 'item-info';
          if (data.rarity === 'legendary' || data.rarity === 'neon') {
            const row = document.createElement('div');
            row.className = 'item-row';
            const sellBtn = document.createElement('button');
            sellBtn.innerText = '–ü—Ä–æ–¥–∞—Ç–∏';
            sellBtn.className = 'sell-btn';
            sellBtn.onclick = function() { confirmSell(item); };
            const nameSpan = document.createElement('span');
            nameSpan.innerText = data.name + (inventory[item] > 1 ? ` √ó${inventory[item]}` : '');
            nameSpan.className = 'item-name';
            const equipBtn = document.createElement('button');
            const isEquipped = equippedLegendaryItems.includes(item);
            equipBtn.innerText = isEquipped ? '–ó–Ω—è—Ç–∏' : '–ï–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏';
            equipBtn.className = 'equip-btn' + (isEquipped ? ' equipped' : '');
            if (!isEquipped && equippedLegendaryItems.length >= 3) {
              equipBtn.disabled = true;
              equipBtn.title = '–ú–æ–∂–Ω–∞ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏ –ª–∏—à–µ 3 –ø—Ä–µ–¥–º–µ—Ç–∏';
            }
            equipBtn.onclick = function() {
              if (isEquipped) {
                equippedLegendaryItems = equippedLegendaryItems.filter(x => x !== item);
              } else {
                if (equippedLegendaryItems.length < 3) {
                  equippedLegendaryItems.push(item);
                }
              }
              updateInventoryUI();
              updateTrainXPUI();
              saveUserData();
            };
            row.appendChild(sellBtn);
            row.appendChild(nameSpan);
            row.appendChild(equipBtn);
            info.appendChild(row);
          } else {
            const nameSpan = document.createElement('span');
            nameSpan.innerText = data.name + (inventory[item] > 1 ? ` √ó${inventory[item]}` : '');
            nameSpan.className = 'item-name';
            info.appendChild(nameSpan);
            const sellBtn = document.createElement('button');
            sellBtn.innerText = '–ü—Ä–æ–¥–∞—Ç–∏';
            sellBtn.className = 'sell-btn';
            sellBtn.style.marginTop = '8px';
            sellBtn.onclick = function() { confirmSell(item); };
            info.appendChild(sellBtn);
          }
          const badge = document.createElement('span');
          badge.className = 'rarity-badge ' + data.rarity;
          badge.innerText = data.rarity === 'neon' ? '–ù–µ–æ–Ω–æ–≤–∞' : (data.rarity === 'legendary' ? '–ó–æ–ª–æ—Ç–∞' : (data.rarity === 'epic' ? '–ü—É—Ä–ø—É—Ä–Ω–∞' : '–ö–∞–º–æ–Ω–∫–∞'));
          info.appendChild(badge);
          const price = document.createElement('span');
          price.className = 'item-price';
          price.innerText = `${data.price} XP`;
          info.appendChild(price);
          li.appendChild(icon);
          li.appendChild(info);
          list.appendChild(li);
        });
      }
      updateTrainXPUI();
    }

    function confirmSell(item) {
      const data = itemMap[item];
      if (confirm(`–ü—Ä–æ–¥–∞—Ç–∏ ${data.name} (${data.rarity === 'legendary' ? '–ó–æ–ª–æ—Ç–∞' : (data.rarity === 'epic' ? '–ü—É—Ä–ø—É—Ä–Ω–∞' : '–ö–∞–º–æ–Ω–∫–∞')}) –∑–∞ ${data.price} XP?`)) {
        sellItem(item);
      }
    }

    function sellItem(item) {
      const data = itemMap[item];
      if (inventory[item] > 1) {
        inventory[item]--;
      } else {
        delete inventory[item];
        equippedLegendaryItems = equippedLegendaryItems.filter(x => x !== item);
      }
      xp += data.price;
      document.getElementById('xp').innerText = xp;
      updateInventoryUI();
      saveUserData();
    }

    // --- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–Ω–∏–∂–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó —Ç–∞ —á–∏—Å—Ç–æ—Ç–∏ ---
    let energyInterval, cleanlinessInterval;

    function isGalaxyEquipped() {
      return equippedLegendaryItems.includes('–ì–∞–ª–∞–∫—Ç–∏—á–Ω–∞ NFT');
    }

    // –û–Ω–æ–≤–ª—é—é getTrainXP
    function getTrainXP() {
      if (isGalaxyEquipped()) return 100000000000;
      let sum = 0;
      for (const item of equippedLegendaryItems) {
        if (itemMap[item] && itemMap[item].rarity === 'legendary') {
          sum += itemMap[item].price;
        }
      }
      if (sum >= 8000) return 10000;
      if (sum >= 4000) return 1000;
      if (sum >= 2000) return 100;
      return 10;
    }

    // –û–Ω–æ–≤–ª—é—é updatePetState
    function updatePetState() {
      if (isGalaxyEquipped()) {
        document.getElementById('energy').innerText = '100%';
        document.getElementById('cleanliness').innerText = '–ß–∏—Å—Ç–æ';
        document.getElementById('mood').innerText = '–©–∞—Å–ª–∏–≤–∏–π';
        updateTrainButton();
        return;
      }
      let energy = parseInt(document.getElementById('energy').innerText);
      let cleanliness = document.getElementById('cleanliness').innerText;
      let mood = '–©–∞—Å–ª–∏–≤–∏–π';
      if (energy < 100 || cleanliness !== '–ß–∏—Å—Ç–æ') mood = '–°–æ–Ω–Ω–∏–π';
      if (cleanliness === '–ë—Ä—É–¥–Ω–æ') mood = '–ü–æ–≥–∞–Ω–∏–π';
      if (energy <= 20 && cleanliness === '–ë—Ä—É–¥–Ω–æ') mood = '–î—É–∂–µ –ø–æ–≥–∞–Ω–∏–π';
      if (energy === 100 && cleanliness === '–ß–∏—Å—Ç–æ') mood = '–©–∞—Å–ª–∏–≤–∏–π';
      document.getElementById('mood').innerText = mood;
      updateTrainButton();
    }

    // –û–Ω–æ–≤–ª—é—é startPetTimers
    function startPetTimers() {
      energyInterval = setInterval(() => {
        if (isGalaxyEquipped()) {
          document.getElementById('energy').innerText = '100%';
          updatePetState();
          saveUserData();
          return;
        }
        let energy = parseInt(document.getElementById('energy').innerText);
        if (isNaN(energy)) energy = 100;
        energy = Math.max(0, energy - 10);
        document.getElementById('energy').innerText = energy + '%';
        updatePetState();
        saveUserData();
      }, 30000);
      cleanlinessInterval = setInterval(() => {
        if (isGalaxyEquipped()) {
          document.getElementById('cleanliness').innerText = '–ß–∏—Å—Ç–æ';
          updatePetState();
          saveUserData();
          return;
        }
        let cleanliness = document.getElementById('cleanliness').innerText;
        if (cleanliness === '–ß–∏—Å—Ç–æ') {
          document.getElementById('cleanliness').innerText = '–¢—Ä–æ—Ö–∏ –±—Ä—É–¥–Ω–æ';
        } else if (cleanliness === '–¢—Ä–æ—Ö–∏ –±—Ä—É–¥–Ω–æ') {
          document.getElementById('cleanliness').innerText = '–ë—Ä—É–¥–Ω–æ';
        }
        updatePetState();
        saveUserData();
      }, 30000);
    }

    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ç–∞–π–º–µ—Ä–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
    window.addEventListener('DOMContentLoaded', () => {
      startPetTimers();
    });

    function setPetSprite(sprite) {
      const petImg = document.querySelector('#pet img');
      if (!petImg) return;
      petImg.src = sprite;
    }
    function animatePet(sprite) {
      setPetSprite(sprite);
      setTimeout(() => setPetSprite('pet.png'), 2000);
    }

    function showScreenBlur() {
      const blur = document.getElementById('blur-overlay');
      if (!blur) return;
      blur.classList.add('active');
      setTimeout(() => blur.classList.remove('active'), 300);
    }

    // –í—Å—ñ –¥—ñ—ó (feedPet, sleepPet, cleanPet, trainPet, explorePet) –ø—ñ—Å–ª—è —Å–≤–æ—î—ó –ª–æ–≥—ñ–∫–∏ —Ä–æ–±–ª—è—Ç—å:
    function enforceGalaxyGodMode() {
      if (isGalaxyEquipped()) {
        document.getElementById('energy').innerText = '100%';
        document.getElementById('cleanliness').innerText = '–ß–∏—Å—Ç–æ';
        document.getElementById('mood').innerText = '–©–∞—Å–ª–∏–≤–∏–π';
        updateTrainXPUI();
        updateTrainButton();
      }
    }

    // --- feedPet ---
    function feedPet() {
      showScreenBlur();
      let energy = parseInt(document.getElementById('energy').innerText);
      energy = Math.min(100, energy + 15);
      document.getElementById('energy').innerText = energy + '%';
      animatePet('food.png');
      updatePetState();
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- sleepPet ---
    function sleepPet() {
      showScreenBlur();
      let energy = parseInt(document.getElementById('energy').innerText);
      energy = Math.min(100, energy + 25);
      document.getElementById('energy').innerText = energy + '%';
      animatePet('zzz.png');
      updatePetState();
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- cleanPet ---
    function cleanPet() {
      showScreenBlur();
      let cleanliness = document.getElementById('cleanliness').innerText;
      if (cleanliness === '–ë—Ä—É–¥–Ω–æ') {
        document.getElementById('cleanliness').innerText = '–¢—Ä–æ—Ö–∏ –±—Ä—É–¥–Ω–æ';
      } else if (cleanliness === '–¢—Ä–æ—Ö–∏ –±—Ä—É–¥–Ω–æ') {
        document.getElementById('cleanliness').innerText = '–ß–∏—Å—Ç–æ';
      }
      const sparkles = document.getElementById('pet-sparkles');
      if (sparkles) {
        sparkles.style.display = 'block';
        setTimeout(() => { sparkles.style.display = 'none'; }, 1500);
      }
      const bubbles = document.getElementById('pet-bubbles');
      if (bubbles) {
        bubbles.innerHTML = '';
        for (let i = 0; i < 8; i++) {
          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          const x = 80 + Math.random()*20;
          const y = 120 + Math.random()*20;
          bubble.style.left = x + 'px';
          bubble.style.top = y + 'px';
          const angle = Math.random() * 2 * Math.PI;
          const dist = 80 + Math.random()*60;
          const tx = Math.cos(angle) * dist;
          const ty = Math.sin(angle) * dist;
          bubble.style.setProperty('--tx', tx+'px');
          bubble.style.setProperty('--ty', ty+'px');
          bubbles.appendChild(bubble);
        }
        bubbles.style.display = 'block';
        setTimeout(() => { bubbles.style.display = 'none'; bubbles.innerHTML = ''; }, 1500);
      }
      const petImg = document.getElementById('pet-img');
      if (petImg) petImg.src = 'pet.png';
      updatePetState();
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- trainPet ---
    function trainPet() {
      showScreenBlur();
      const mood = document.getElementById('mood').innerText;
      if (mood === '–°–æ–Ω–Ω–∏–π' || mood === '–ü–æ–≥–∞–Ω–∏–π' || mood === '–î—É–∂–µ –ø–æ–≥–∞–Ω–∏–π') {
        showNotification('IRYS –Ω–µ –º–æ–∂–µ —Ç—Ä–µ–Ω—É–≤–∞—Ç–∏—Å—è –∑ –ø–æ–≥–∞–Ω–∏–º –Ω–∞—Å—Ç—Ä–æ—î–º! –°–ø–æ—á–∞—Ç–∫—É –ø–æ–∫–æ—Ä–º–∏, –ø–æ—á–∏—Å—Ç–∏ –∞–±–æ –ø–æ–∫–ª–∞–¥–∏ —Å–ø–∞—Ç–∏.');
        enforceGalaxyGodMode();
        saveUserData();
        return;
      }
      const trainXP = getTrainXP();
      xp += trainXP;
      document.getElementById('xp').innerText = xp;
      updateTrainXPUI();
      animatePet('geam.png');
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- explorePet ---
    function explorePet() {
      const casePrice = 10000;
      if (xp < casePrice && !isGalaxyEquipped()) {
        showNotification(`–ü–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º ${casePrice} XP –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∫–µ–π—Å—É!`);
        saveUserData();
        return;
      }
      if (!isGalaxyEquipped()) xp -= casePrice;
      document.getElementById('xp').innerText = xp;
      const foundItem = getRandomItem();
      if (!inventory[foundItem]) {
        inventory[foundItem] = 0;
      }
      inventory[foundItem]++;
      updateInventoryUI();
      // --- –ê–Ω—ñ–º–∞—Ü—ñ—è –∑—ñ—Ä–æ—á–æ–∫ –Ω–∞–¥ –ø–µ—Ç–æ–º ---
      animatePet('pet.png');
      showStarsAbovePet();
      showNotification(`–í–∏ –∑–Ω–∞–π—à–ª–∏: ${foundItem} (${itemMap[foundItem].rarity === 'neon' ? '–ù–µ–æ–Ω–æ–≤–∞' : (itemMap[foundItem].rarity === 'legendary' ? '–ó–æ–ª–æ—Ç–∞' : (itemMap[foundItem].rarity === 'epic' ? '–ü—É—Ä–ø—É—Ä–Ω–∞' : '–ö–∞–º–æ–Ω–∫–∞'))})`);
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }

    // –î–æ–¥–∞—é —Ñ—É–Ω–∫—Ü—ñ—é showStarsAbovePet
    function showStarsAbovePet() {
      let pet = document.getElementById('pet');
      if (!pet) return;
      let starsContainer = document.createElement('div');
      starsContainer.style.position = 'absolute';
      starsContainer.style.left = '0';
      starsContainer.style.top = '0';
      starsContainer.style.width = '100%';
      starsContainer.style.height = '100%';
      starsContainer.style.pointerEvents = 'none';
      starsContainer.style.zIndex = '10';
      for (let i = 0; i < 8; i++) {
        let star = document.createElement('div');
        star.style.position = 'absolute';
        star.style.left = (40 + Math.random()*100) + 'px';
        star.style.top = (60 + Math.random()*40) + 'px';
        star.style.width = '32px';
        star.style.height = '32px';
        star.style.background = 'none';
        star.style.backgroundImage = "url('https://cdn-icons-png.flaticon.com/512/616/616489.png')";
        star.style.backgroundSize = 'contain';
        star.style.backgroundRepeat = 'no-repeat';
        star.style.opacity = '0.9';
        star.style.transform = 'scale(0.7)';
        star.style.transition = 'none';
        star.style.pointerEvents = 'none';
        star.style.filter = 'drop-shadow(0 0 12px #FFD700)';
        // –ê–Ω—ñ–º–∞—Ü—ñ—è
        star.animate([
          { transform: 'scale(0.7) translateY(0)', opacity: 0.9 },
          { transform: 'scale(1.2) translateY(-120px)', opacity: 0.1 }
        ], {
          duration: 1200 + Math.random()*400,
          easing: 'cubic-bezier(.4,1.4,.6,1)',
          fill: 'forwards'
        });
        starsContainer.appendChild(star);
      }
      pet.appendChild(starsContainer);
      setTimeout(() => { if (starsContainer.parentNode) starsContainer.parentNode.removeChild(starsContainer); }, 1400);
    }
    // ---

    function openMarketplace() {
      document.getElementById('marketplace-modal').style.display = 'flex';
      renderMarketplace();
    }

    function closeMarketplace() {
      document.getElementById('marketplace-modal').style.display = 'none';
    }

    function renderMarketplace() {
      const list = document.getElementById('marketplace-list');
      list.innerHTML = '';
      itemData.forEach(item => {
        const li = document.createElement('li');
        li.style.display = 'flex';
        li.style.alignItems = 'center';
        li.style.gap = '18px';
        li.style.background = 'rgba(255,255,255,0.10)';
        li.style.borderRadius = '16px';
        li.style.padding = '12px 18px';
        // –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –∑–∞ —Ä—ñ–¥–∫—ñ—Å—Ç—é
        if (item.rarity === 'legendary') li.classList.add('market-legendary');
        else if (item.rarity === 'epic') li.classList.add('market-epic');
        else if (item.rarity === 'neon') li.classList.add('market-neon');
        else li.classList.add('market-common');
        // –Ü–∫–æ–Ω–∫–∞
        const icon = document.createElement('span');
        icon.className = 'item-icon';
        icon.style.backgroundImage = `url('${item.icon}')`;
        icon.style.width = '40px';
        icon.style.height = '40px';
        icon.style.backgroundSize = 'contain';
        icon.style.backgroundRepeat = 'no-repeat';
        icon.style.backgroundPosition = 'center';
        // –ù–∞–∑–≤–∞
        const name = document.createElement('span');
        name.innerText = item.name;
        name.style.fontWeight = '600';
        name.style.flex = '1 1 0';
        // –†—ñ–¥–∫—ñ—Å—Ç—å
        const badge = document.createElement('span');
        badge.className = 'rarity-badge ' + item.rarity;
        badge.innerText = item.rarity === 'neon' ? '–ù–µ–æ–Ω–æ–≤–∞' : (item.rarity === 'legendary' ? '–ó–æ–ª–æ—Ç–∞' : (item.rarity === 'epic' ? '–ü—É—Ä–ø—É—Ä–Ω–∞' : '–ö–∞–º–æ–Ω–∫–∞'));
        // –¶—ñ–Ω–∞ (—É 10 —Ä–∞–∑—ñ–≤ –¥–æ—Ä–æ–∂—á–µ)
        const marketPrice = item.price * 10;
        const price = document.createElement('span');
        price.className = 'item-price';
        price.innerText = `${marketPrice} XP`;
        // –ö—ñ–ª—å–∫—ñ—Å—Ç—å —É –≥—Ä–∞–≤—Ü—è
        const count = document.createElement('span');
        count.innerText = `–£ –≤–∞—Å: ${inventory[item.name] || 0}`;
        count.style.color = 'var(--accent2)';
        count.style.fontSize = '0.95em';
        // –ö–Ω–æ–ø–∫–∞ –∫—É–ø–∏—Ç–∏
        const buyBtn = document.createElement('button');
        buyBtn.innerText = '–ö—É–ø–∏—Ç–∏';
        buyBtn.className = 'buy-btn';
        buyBtn.disabled = xp < marketPrice;
        if (buyBtn.disabled) buyBtn.title = '–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ XP';
        buyBtn.onclick = function() { buyItemFromMarketplace(item.name, marketPrice); };
        li.appendChild(icon);
        li.appendChild(name);
        li.appendChild(badge);
        li.appendChild(price);
        li.appendChild(count);
        li.appendChild(buyBtn);
        list.appendChild(li);
      });
    }

    function buyItemFromMarketplace(itemName, marketPrice) {
      const item = itemMap[itemName];
      if (xp < marketPrice) return;
      xp -= marketPrice;
      if (inventory[itemName]) inventory[itemName]++;
      else inventory[itemName] = 1;
      document.getElementById('xp').innerText = xp;
      updateInventoryUI();
      renderMarketplace();
      saveUserData();
    }

    // --- API ---
    async function saveUserData() {
      const data = {
        xp,
        inventory,
        equippedLegendaryItems,
        energy: document.getElementById('energy').innerText,
        mood: document.getElementById('mood').innerText,
        cleanliness: document.getElementById('cleanliness').innerText
      };
      try {
        const res = await fetch('http://localhost:3000/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!res.ok) {
          if (res.status === 401) {
            showNotification('–î–∞–Ω—ñ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Discord.');
          } else {
            showNotification('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö!');
          }
          console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', res.status, await res.text());
        }
      } catch (e) {
        showNotification('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è! –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π.');
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', e);
      }
    }

    async function loadUserData() {
      try {
        const res = await fetch('http://localhost:3000/load');
        if (!res.ok) return;
        const data = await res.json();
        console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ:', data);
        xp = data.xp || 0;
        inventory = data.inventory || {};
        equippedLegendaryItems = data.equippedLegendaryItems || [];
        console.log('–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', inventory);
        document.getElementById('xp').innerText = xp;
        document.getElementById('energy').innerText = data.energy || '100%';
        document.getElementById('mood').innerText = data.mood || '–©–∞—Å–ª–∏–≤–∏–π';
        document.getElementById('cleanliness').innerText = data.cleanliness || '–ß–∏—Å—Ç–æ';
        updateInventoryUI();
        updateTrainXPUI();
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', e);
      }
    }

    // --- Discord Login (OAuth2) ---
    async function checkDiscordAuth() {
      try {
        const res = await fetch('/me');
        const data = await res.json();
        if (data.loggedIn) {
          // –ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Ñ—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
          document.getElementById('discord-login-modal').style.display = 'none';
          document.getElementById('discord-user-info').style.display = 'flex';
          document.getElementById('discord-username').innerText = data.user.username;
          document.getElementById('discord-avatar').src = data.user.avatar ? `https://cdn.discordapp.com/avatars/${data.user.id}/${data.user.avatar}.png` : 'https://cdn-icons-png.flaticon.com/512/5968/5968756.png';
          loadUserData();
        } else {
          document.getElementById('discord-login-modal').style.display = 'flex';
          document.getElementById('discord-user-info').style.display = 'none';
        }
      } catch (e) {
        document.getElementById('discord-login-modal').style.display = 'flex';
        document.getElementById('discord-user-info').style.display = 'none';
      }
    }
    window.onload = checkDiscordAuth;

    // --- –õ–æ–≥—ñ–∫–∞ –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è/–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è ---
    const inventoryContainer = document.getElementById('inventory');
    const expandBtn = document.getElementById('expandInventoryBtn');
    const inventoryBackdrop = document.getElementById('inventory-backdrop');
    const inventoryHeader = document.getElementById('inventoryHeader');
    let inventoryFullscreen = false;
    expandBtn.onclick = function() {
      inventoryFullscreen = !inventoryFullscreen;
      if (inventoryFullscreen) {
        inventoryContainer.classList.add('fullscreen');
        inventoryHeader.style.display = 'flex';
        expandBtn.innerText = '‚úñ';
        expandBtn.title = '–ó–≥–æ—Ä–Ω—É—Ç–∏ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä';
        inventoryBackdrop.style.display = 'block';
      } else {
        inventoryContainer.classList.remove('fullscreen');
        inventoryHeader.style.display = 'none';
        expandBtn.innerText = '‚§¢';
        expandBtn.title = '–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä';
        inventoryBackdrop.style.display = 'none';
      }
    };

    function openRulesModal() {
      document.getElementById('rules-modal').style.display = 'flex';
    }

    function closeRulesModal() {
      document.getElementById('rules-modal').style.display = 'none';
    }

    function openAuthorsModal() {
      document.getElementById('authors-modal').style.display = 'flex';
    }

    function closeAuthorsModal() {
      document.getElementById('authors-modal').style.display = 'none';
    }

    // –ö–∞—Å—Ç–æ–º–Ω–∏–π tooltip –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é
    const tooltip = document.getElementById('custom-tooltip');
    document.querySelectorAll('#menu .icon-btn').forEach(btn => {
      btn.addEventListener('mouseenter', function(e) {
        const text = btn.getAttribute('title');
        if (!text) return;
        tooltip.innerText = text;
        tooltip.classList.add('active');
        const rect = btn.getBoundingClientRect();
        tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 8) + 'px';
      });
      btn.addEventListener('mousemove', function(e) {
        const rect = btn.getBoundingClientRect();
        tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 8) + 'px';
      });
      btn.addEventListener('mouseleave', function() {
        tooltip.classList.remove('active');
      });
    });

    // –î–æ–¥–∞—é —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–Ω–æ–ø–∫–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
    function updateTrainButton() {
      const trainBtn = document.querySelector('#menu .icon-btn[onclick="trainPet()"]');
      const mood = document.getElementById('mood').innerText;
      if (mood === '–°–æ–Ω–Ω–∏–π' || mood === '–ü–æ–≥–∞–Ω–∏–π' || mood === '–î—É–∂–µ –ø–æ–≥–∞–Ω–∏–π') {
        trainBtn.disabled = true;
        trainBtn.style.opacity = '0.5';
        trainBtn.title = 'IRYS –Ω–µ –º–æ–∂–µ —Ç—Ä–µ–Ω—É–≤–∞—Ç–∏—Å—è –∑ –ø–æ–≥–∞–Ω–∏–º –Ω–∞—Å—Ç—Ä–æ—î–º';
      } else {
        trainBtn.disabled = false;
        trainBtn.style.opacity = '1';
        trainBtn.title = '–¢—Ä–µ–Ω—É–≤–∞—Ç–∏';
      }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ —Å–∞–π—Ç—ñ
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.innerText = message;
      notification.style.display = 'block';
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥–∏
      setTimeout(() => {
        notification.style.display = 'none';
      }, 4000);
    }

    // –°–∏—Å—Ç–µ–º–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –ø–æ–¥—ñ–π
    const events = [
      {
        name: "–Ü—Ä—Å—É –ø—Ä–∏—Å–Ω–∏–ª–æ—Å—è –∂–∞—Ö—ñ—Ç—Ç—è",
        description: "–ü—ñ–¥ —á–∞—Å —Å–Ω—É –Ü—Ä—Å—É –ø—Ä–∏—Å–Ω–∏–ª–æ—Å—è –∂–∞—Ö—ñ—Ç—Ç—è, —Ç–æ–º—É –≤ –Ω–µ—ó –≤–µ—Å—å –¥–µ–Ω—å –ø–æ–≥–∞–Ω–∏–π –Ω–∞—Å—Ç—Ä—ñ–π",
        effect: () => {
          document.getElementById('mood').innerText = '–ü–æ–≥–∞–Ω–∏–π';
          updateTrainButton();
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ —Å–∫–∞—Ä–±",
        description: "–ü—ñ–¥ —á–∞—Å –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π —Å–∫–∞—Ä–±!",
        effect: () => {
          xp += 500;
          document.getElementById('xp').innerText = xp;
          showNotification("–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ —Å–∫–∞—Ä–±! +500 XP");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑'—ó–ª–∞ —â–æ—Å—å –ø–æ–≥–∞–Ω–µ",
        description: "–Ü—Ä—Å—É –∑'—ó–ª–∞ —â–æ—Å—å –Ω–µ —Ç–µ, —Ç–µ–ø–µ—Ä –≤–æ–Ω–∞ –ø–æ—á—É–≤–∞—î—Ç—å—Å—è –Ω–µ –¥–æ–±—Ä–µ",
        effect: () => {
          let energy = parseInt(document.getElementById('energy').innerText);
          energy = Math.max(0, energy - 30);
          document.getElementById('energy').innerText = energy;
          updatePetState();
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ –Ω–æ–≤–∏–π —Ä–µ–∫–æ—Ä–¥",
        description: "–ü—ñ–¥ —á–∞—Å —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ü—Ä—Å—É –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∞ –Ω–æ–≤–∏–π –æ—Å–æ–±–∏—Å—Ç–∏–π —Ä–µ–∫–æ—Ä–¥!",
        effect: () => {
          xp += 200;
          document.getElementById('xp').innerText = xp;
          showNotification("–ù–æ–≤–∏–π —Ä–µ–∫–æ—Ä–¥! +200 XP");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –¥–∏–≤–Ω–∏–π –∫–∞–º—ñ–Ω—å",
        description: "–ü—ñ–¥ —á–∞—Å –ø—Ä–æ–≥—É–ª—è–Ω–∫–∏ –Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –¥–∏–≤–Ω–∏–π –∫–∞–º—ñ–Ω—å, —è–∫–∏–π —Å–≤—ñ—Ç–∏—Ç—å—Å—è",
        effect: () => {
          xp += 150;
          document.getElementById('xp').innerText = xp;
          showNotification("–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –¥–∏–≤–Ω–∏–π –∫–∞–º—ñ–Ω—å! +150 XP");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ —Ñ—ñ–∑–∏—á–Ω—É –≤–ø—Ä–∞–≤—É",
        description: "–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ –∫—ñ–ª—å–∫–∞ —Ñ—ñ–∑–∏—á–Ω–∏—Ö –≤–ø—Ä–∞–≤ —ñ –ø–æ—á—É–≤–∞—î—Ç—å—Å—è –µ–Ω–µ—Ä–≥—ñ–π–Ω—ñ—à–µ",
        effect: () => {
          let energy = parseInt(document.getElementById('energy').innerText);
          energy = Math.min(100, energy + 20);
          document.getElementById('energy').innerText = energy;
          updatePetState();
          showNotification("–Ü—Ä—Å—É –ø–æ—á—É–≤–∞—î—Ç—å—Å—è –µ–Ω–µ—Ä–≥—ñ–π–Ω—ñ—à–µ! +20 –µ–Ω–µ—Ä–≥—ñ—ó");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –∫–≤—ñ—Ç–∫—É",
        description: "–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –∫—Ä–∞—Å–∏–≤—É –∫–≤—ñ—Ç–∫—É —ñ –ø–æ–¥–∞—Ä—É–≤–∞–ª–∞ —ó—ó –≤–∞–º",
        effect: () => {
          xp += 100;
          document.getElementById('xp').innerText = xp;
          showNotification("–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ –∫—Ä–∞—Å–∏–≤—É –∫–≤—ñ—Ç–∫—É! +100 XP");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ –¥–æ–±—Ä—É —Å–ø—Ä–∞–≤—É",
        description: "–Ü—Ä—Å—É –¥–æ–ø–æ–º–æ–≥–ª–∞ –∫–æ–º—É—Å—å —ñ –ø–æ—á—É–≤–∞—î—Ç—å—Å—è —â–∞—Å–ª–∏–≤–æ—é",
        effect: () => {
          document.getElementById('mood').innerText = '–©–∞—Å–ª–∏–≤–∏–π';
          updateTrainButton();
          showNotification("–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ –¥–æ–±—Ä—É —Å–ø—Ä–∞–≤—É —ñ —â–∞—Å–ª–∏–≤–∞!");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ —Å—Ç–∞—Ä–∏–π –¥–Ω–µ–≤–Ω–∏–∫",
        description: "–ü—ñ–¥ —á–∞—Å –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ —Å—Ç–∞—Ä–∏–π –¥–Ω–µ–≤–Ω–∏–∫ –∑ —Ü—ñ–∫–∞–≤–∏–º–∏ —ñ—Å—Ç–æ—Ä—ñ—è–º–∏",
        effect: () => {
          xp += 300;
          document.getElementById('xp').innerText = xp;
          showNotification("–Ü—Ä—Å—É –∑–Ω–∞–π—à–ª–∞ —Å—Ç–∞—Ä–∏–π –¥–Ω–µ–≤–Ω–∏–∫! +300 XP");
        }
      },
      {
        name: "–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ –º–µ–¥–∏—Ç–∞—Ü—ñ—é",
        description: "–Ü—Ä—Å—É –∑—Ä–æ–±–∏–ª–∞ –∫–æ—Ä–æ—Ç–∫—É –º–µ–¥–∏—Ç–∞—Ü—ñ—é —ñ –≤—ñ–¥–Ω–æ–≤–∏–ª–∞ —Å–ø–æ–∫—ñ–π",
        effect: () => {
          let energy = parseInt(document.getElementById('energy').innerText);
          energy = Math.min(100, energy + 15);
          document.getElementById('energy').innerText = energy;
          updatePetState();
          showNotification("–Ü—Ä—Å—É –≤—ñ–¥–Ω–æ–≤–∏–ª–∞ —Å–ø–æ–∫—ñ–π –ø—ñ—Å–ª—è –º–µ–¥–∏—Ç–∞—Ü—ñ—ó! +15 –µ–Ω–µ—Ä–≥—ñ—ó");
        }
      }
    ];
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∫–ª–∏–∫—É –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó –ø–æ–¥—ñ—ó
    function triggerRandomEvent() {
      // 15% —à–∞–Ω—Å –ø–æ–¥—ñ—ó –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –¥—ñ—ó
      if (Math.random() < 0.15) {
        const randomEvent = events[Math.floor(Math.random() * events.length)];
        showNotification(randomEvent.description);
        randomEvent.effect();
        saveUserData();
      }
    }

    function openInventory() {
      document.getElementById('inventory-modal').style.display = 'flex';
      renderInventoryModal();
    }

    function closeInventory() {
      document.getElementById('inventory-modal').style.display = 'none';
    }

    function renderInventoryModal() {
      const list = document.getElementById('inventory-modal-list');
      const countSpan = document.getElementById('inventory-count');
      list.innerHTML = '';
      
      console.log('renderInventoryModal - –ø–æ—Ç–æ—á–Ω–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä:', inventory);
      console.log('renderInventoryModal - itemData:', itemData);
      
      let totalItems = 0;
      
      // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –≤ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—ñ
      Object.keys(inventory).forEach(item => {
        totalItems += inventory[item];
      });
      
      countSpan.innerText = `–ü—Ä–µ–¥–º–µ—Ç—ñ–≤: ${totalItems}`;
      
      // –ü–æ–∫–∞–∑—É—î–º–æ –≤—Å—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –∑ itemData
      const allItems = itemData.map(item => item.name);
      
      if (allItems.length === 0) {
        const li = document.createElement('li');
        li.innerText = '–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π';
        li.style.textAlign = 'center';
        li.style.color = 'var(--text-soft)';
        li.style.padding = '40px 20px';
        li.style.fontSize = '1.1em';
        list.appendChild(li);
      } else {
        allItems.forEach((item) => {
          const data = itemMap[item];
          if (!data) return; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø—Ä–µ–¥–º–µ—Ç–∏ —è–∫—ñ –Ω–µ —ñ—Å–Ω—É—é—Ç—å –≤ itemMap
          
          const itemCount = inventory[item] || 0;
          
          const li = document.createElement('li');
          li.style.background = 'rgba(255,255,255,0.08)';
          li.style.borderRadius = '16px';
          li.style.padding = '20px';
          li.style.display = 'flex';
          li.style.alignItems = 'center';
          li.style.gap = '16px';
          li.style.border = '1px solid rgba(255,255,255,0.1)';
          
          // –†–æ–±–∏–º–æ –ø—Ä–µ–¥–º–µ—Ç –±–ª—ñ–¥–∏–º —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î –≤ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—ñ
          if (itemCount === 0) {
            li.style.opacity = '0.5';
          }
          
          if (data.rarity === 'legendary' && equippedLegendaryItems.includes(item)) {
            li.style.border = '2px solid gold';
            li.style.boxShadow = '0 0 16px 0 gold';
          }
          
          const icon = document.createElement('div');
          icon.style.width = '48px';
          icon.style.height = '48px';
          icon.style.backgroundImage = `url('${data.icon}')`;
          icon.style.backgroundSize = 'contain';
          icon.style.backgroundRepeat = 'no-repeat';
          icon.style.backgroundPosition = 'center';
          icon.style.borderRadius = '8px';
          icon.style.backgroundColor = 'rgba(255,255,255,0.1)';
          
          const info = document.createElement('div');
          info.style.flex = '1';
          info.style.display = 'flex';
          info.style.flexDirection = 'column';
          info.style.gap = '8px';
          
          const nameSpan = document.createElement('span');
          nameSpan.innerText = data.name + (itemCount > 1 ? ` √ó${itemCount}` : '') + (itemCount === 0 ? ' (–Ω–µ–º–∞—î)' : '');
          nameSpan.style.fontWeight = '600';
          nameSpan.style.fontSize = '1.1em';
          nameSpan.style.color = 'var(--text-main)';
          
          const raritySpan = document.createElement('span');
          raritySpan.innerText = data.rarity === 'neon' ? '–ù–µ–æ–Ω–æ–≤–∞' : (data.rarity === 'legendary' ? '–ó–æ–ª–æ—Ç–∞' : (data.rarity === 'epic' ? '–ü—É—Ä–ø—É—Ä–Ω–∞' : '–ö–∞–º–æ–Ω–∫–∞'));
          raritySpan.style.fontSize = '0.9em';
          raritySpan.style.color = data.rarity === 'neon' ? '#00fff0' : (data.rarity === 'legendary' ? '#FFD700' : (data.rarity === 'epic' ? '#DA70D6' : '#C0C0C0'));
          
          const priceSpan = document.createElement('span');
          priceSpan.innerText = `${data.price} XP`;
          priceSpan.style.fontSize = '0.9em';
          priceSpan.style.color = 'var(--accent)';
          
          info.appendChild(nameSpan);
          info.appendChild(raritySpan);
          info.appendChild(priceSpan);
          
          const actions = document.createElement('div');
          actions.style.display = 'flex';
          actions.style.flexDirection = 'column';
          actions.style.gap = '8px';
          
          // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–∞–∂—É —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ø—Ä–µ–¥–º–µ—Ç —î –≤ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—ñ
          if (itemCount > 0) {
            const sellBtn = document.createElement('button');
            sellBtn.innerText = '–ü—Ä–æ–¥–∞—Ç–∏';
            sellBtn.style.background = 'var(--accent)';
            sellBtn.style.color = '#000';
            sellBtn.style.border = 'none';
            sellBtn.style.borderRadius = '8px';
            sellBtn.style.padding = '8px 16px';
            sellBtn.style.fontSize = '0.9em';
            sellBtn.style.cursor = 'pointer';
            sellBtn.style.fontWeight = '600';
            sellBtn.onclick = function() { 
              confirmSell(item);
              // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä –ø—ñ—Å–ª—è –ø—Ä–æ–¥–∞–∂—É
              setTimeout(() => {
                renderInventoryModal();
              }, 100);
            };
            
            actions.appendChild(sellBtn);
          }
          
          if (data.rarity === 'legendary' || data.rarity === 'neon') {
            const equipBtn = document.createElement('button');
            const isEquipped = equippedLegendaryItems.includes(item);
            equipBtn.innerText = isEquipped ? '–ó–Ω—è—Ç–∏' : (itemCount > 0 ? '–ï–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏' : '–ï–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏ (–Ω–µ–º–∞—î)');
            equipBtn.style.background = isEquipped ? '#ff6b6b' : '#4CAF50';
            equipBtn.style.color = '#fff';
            equipBtn.style.border = 'none';
            equipBtn.style.borderRadius = '8px';
            equipBtn.style.padding = '8px 16px';
            equipBtn.style.fontSize = '0.9em';
            equipBtn.style.cursor = (itemCount > 0 && !isEquipped) ? 'pointer' : 'not-allowed';
            equipBtn.style.fontWeight = '600';
            
            if (!isEquipped && (equippedLegendaryItems.length >= 3 || itemCount === 0)) {
              equipBtn.disabled = true;
              equipBtn.style.opacity = '0.5';
            }
            
            equipBtn.onclick = function() {
              if (itemCount === 0 && !isEquipped) return; // –ù–µ –º–æ–∂–Ω–∞ –µ–∫—ñ–ø—ñ—Ä—É–≤–∞—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç —è–∫–æ–≥–æ –Ω–µ–º–∞—î
              
              if (isEquipped) {
                equippedLegendaryItems = equippedLegendaryItems.filter(x => x !== item);
              } else {
                if (equippedLegendaryItems.length < 3) {
                  equippedLegendaryItems.push(item);
                }
              }
              updateInventoryUI();
              updateTrainXPUI();
              saveUserData();
              // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä –ø—ñ—Å–ª—è –µ–∫—ñ–ø—ñ—Ä—É–≤–∞–Ω–Ω—è
              setTimeout(() => {
                renderInventoryModal();
              }, 100);
            };
            
            actions.appendChild(equipBtn);
          }
          
          li.appendChild(icon);
          li.appendChild(info);
          li.appendChild(actions);
          list.appendChild(li);
        });
      }
    }

    // –î–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    window.addEventListener('DOMContentLoaded', () => {
      loadUserData();
    });

    function updateTrainXPUI() {
      document.getElementById('xp-per-train').innerText = `+${getTrainXP()} XP –∑–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è`;
    }
  </script>
  <button id="open-case-btn" onclick="explorePet()" title="–í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–µ–π—Å" style="
    position: fixed;
    right: 36px;
    bottom: 36px;
    z-index: 3001;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: linear-gradient(90deg, #00fff0 0%, #a259f7 100%);
    color: #fff;
    border: none;
    box-shadow: 0 0 32px 8px #00fff0, 0 0 64px 16px #a259f7;
    font-size: 2.8em;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    outline: none;
    transition: box-shadow 0.18s, transform 0.13s;
    animation: neon-pulse 1.5s infinite alternate;
  ">
    <span style="display:inline-block; font-size:1.2em;">üîÆ</span>
  </button>
  <style>
  @keyframes neon-pulse {
    from { box-shadow: 0 0 32px 8px #00fff0, 0 0 64px 16px #a259f7; }
    to { box-shadow: 0 0 64px 16px #00fff0, 0 0 128px 32px #a259f7; }
  }
  @media (max-width: 700px) {
    #open-case-btn {
      right: 12px;
      bottom: 12px;
      width: 60px;
      height: 60px;
      font-size: 1.6em;
    }
  }
  </style>
  <!-- –î–æ–¥–∞—é –∫–∞—Å—Ç–æ–º–Ω–∏–π tooltip –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∫–µ–π—Å—É -->
  <div id="open-case-tooltip" style="
    display:none;
    position:fixed;
    z-index:4000;
    background:rgba(0,0,0,0.92);
    color:#fff;
    padding:14px 22px;
    border-radius:14px;
    font-size:1.1em;
    font-weight:600;
    pointer-events:none;
    box-shadow:0 0 24px 4px #00fff0, 0 0 8px 2px #a259f7;
    text-shadow:0 0 8px #00fff0, 0 0 2px #fff;
    transition:opacity 0.2s;
    opacity:0;
  "></div>
  <script>
  const openCaseBtn = document.getElementById('open-case-btn');
  const openCaseTooltip = document.getElementById('open-case-tooltip');
  if (openCaseBtn && openCaseTooltip) {
    openCaseBtn.addEventListener('mouseenter', function(e) {
      let price = isGalaxyEquipped() ? '–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (–∑ Galaxy)' : '10000 XP';
      openCaseTooltip.innerHTML = `<span style='font-size:1.2em;'>üîÆ</span> –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–µ–π—Å<br><span style='color:#00fff0;'>${price}</span>`;
      openCaseTooltip.style.display = 'block';
      openCaseTooltip.style.opacity = '1';
      const rect = openCaseBtn.getBoundingClientRect();
      openCaseTooltip.style.left = (rect.left + rect.width/2 - openCaseTooltip.offsetWidth/2) + 'px';
      openCaseTooltip.style.top = (rect.top - openCaseTooltip.offsetHeight - 18) + 'px';
    });
    openCaseBtn.addEventListener('mousemove', function(e) {
      const rect = openCaseBtn.getBoundingClientRect();
      openCaseTooltip.style.left = (rect.left + rect.width/2 - openCaseTooltip.offsetWidth/2) + 'px';
      openCaseTooltip.style.top = (rect.top - openCaseTooltip.offsetHeight - 18) + 'px';
    });
    openCaseBtn.addEventListener('mouseleave', function() {
      openCaseTooltip.style.opacity = '0';
      setTimeout(()=>{ openCaseTooltip.style.display = 'none'; }, 200);
    });
  }
  </script>
</body>
</html>