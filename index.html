<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>TamagIRYS - Гра</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --glass-bg: rgba(255,255,255,0.13);
      --glass-blur: 18px;
      --glass-border: rgba(255,255,255,0.25);
      --accent: #06EAD3;
      --accent2: #A4FEFD;
      --text-main: #fff;
      --text-soft: #A4FEFD;
      --shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, Arial, sans-serif;
      background: linear-gradient(120deg, #000000 100%, #000000 100%);
      color: var(--text-main);
      min-height: 100vh;
      box-sizing: border-box;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-bottom: 80px;
    }
    h1 {
      font-size: 2.2em;
      font-weight: 600;
      margin: 32px 0 24px 0;
      letter-spacing: 0.02em;
      color: var(--accent);
      text-shadow: none;
    }
    /* Glassmorphism block */
    .glass {
      background: var(--glass-bg);
      border-radius: 24px;
      box-shadow: var(--shadow);
      border: 1.5px solid var(--glass-border);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
    }
    /* HUD */
    #hud {
      position: fixed;
      top: 32px;
      left: 32px;
      min-width: 220px;
      padding: 24px 32px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      font-size: 1.1em;
      color: var(--text-main);
      z-index: 1002;
      font-weight: 500;
    }
    #hud .hud-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #hud .hud-label {
      color: var(--text-soft);
      font-weight: 400;
      min-width: 80px;
    }
    #hud .hud-value {
      color: var(--accent);
      font-weight: 600;
      font-size: 1.1em;
      background: rgba(255,255,255,0.22);
      border-radius: 8px;
      padding: 2px 14px;
      min-width: 60px;
      text-align: center;
      box-shadow: none;
    }
    /* Інвентар */
    .inventory-container {
      position: fixed;
      top: 32px;
      right: 32px;
      min-width: 320px;
      max-width: 420px;
      padding: 32px 32px 24px 32px;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 18px;
    }
    .inventory-container .expand-btn {
      position: absolute;
      top: 18px;
      left: 18px;
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.5em;
      cursor: pointer;
      z-index: 10;
      transition: color 0.2s;
      padding: 2px 8px;
    }
    .inventory-container .expand-btn:hover {
      color: var(--accent2);
    }
    .inventory-container.fullscreen {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 96vw;
      max-width: 700px;
      height: 90vh;
      min-width: 320px;
      max-height: 90vh;
      border-radius: 32px;
      padding: 0;
      z-index: 2000;
      background: #181c24;
      box-shadow: 0 12px 48px 0 rgba(31,38,135,0.25);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      overflow: hidden;
    }
    .inventory-container.fullscreen .inventory-header {
      width: 100%;
      background: #232946;
      border-top-left-radius: 32px;
      border-top-right-radius: 32px;
      padding: 24px 32px 18px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-sizing: border-box;
      box-shadow: 0 2px 12px 0 rgba(31,38,135,0.10);
    }
    .inventory-container.fullscreen .inventory-header h2 {
      margin: 0;
      font-size: 1.3em;
      color: var(--accent2);
      font-weight: 600;
      letter-spacing: 0.01em;
    }
    .inventory-container.fullscreen .expand-btn {
      position: static;
      color: #fff;
      background: none;
      border: none;
      font-size: 2em;
      cursor: pointer;
      padding: 0 8px;
      margin: 0;
      border-radius: 8px;
      transition: background 0.2s, color 0.2s;
    }
    .inventory-container.fullscreen .expand-btn:hover {
      background: #232946;
      color: var(--accent);
    }
    .inventory-container.fullscreen .inventory-list {
      flex: 1 1 0;
      width: 100%;
      max-height: unset;
      overflow-y: auto;
      padding: 24px 32px 24px 32px;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 18px;
      background: none;
    }
    .inventory-container.fullscreen .inventory-list li {
      background: #232946;
      border-radius: 18px;
      padding: 18px 18px 70px 70px;
      min-height: 90px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: 0 2px 8px 0 rgba(31,38,135,0.10);
      font-size: 1em;
      color: #fff;
      gap: 6px;
      overflow: hidden;
    }
    .inventory-container.fullscreen .inventory-list li .item-icon {
      position: absolute;
      left: 18px;
      top: 24px;
      width: 40px;
      height: 40px;
      background-size: contain;
      background-repeat: no-repeat;
      filter: drop-shadow(0 2px 8px rgba(6,234,211,0.12));
    }
    .inventory-container.fullscreen .inventory-list li .sell-btn {
      position: absolute;
      left: 18px;
      right: 18px;
      bottom: 18px;
      width: auto;
      margin: 0;
      padding: 14px 0;
      font-size: 1em;
      text-align: center;
      pointer-events: auto;
      z-index: 2;
      border-radius: 10px;
      background: var(--accent2);
      color: #181c24;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
      box-shadow: none;
      word-break: break-word;
      min-width: 80px;
      max-width: 100%;
    }
    .inventory-container.fullscreen .inventory-list li .sell-btn:hover {
      background: var(--accent);
      color: #fff;
    }
    @media (max-width: 700px) {
      .inventory-container.fullscreen {
        width: 99vw;
        max-width: 99vw;
        height: 98vh;
        max-height: 98vh;
        border-radius: 18px;
      }
      .inventory-container.fullscreen .inventory-header,
      .inventory-container.fullscreen .inventory-list {
        padding-left: 8px;
        padding-right: 8px;
      }
    }
    .inventory-container h2 {
      font-size: 1.3em;
      font-weight: 600;
      margin: 0 0 10px 0;
      color: var(--accent);
      letter-spacing: 0.01em;
    }
    .inventory-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 18px;
      max-height: 40vh;
      overflow-y: auto;
      padding: 0;
      margin: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--accent2) rgba(0,0,0,0.1);
    }
    .inventory-container.fullscreen .inventory-list {
      max-height: 70vh;
    }
    .inventory-list li {
      list-style: none;
      background: rgba(255,255,255,0.18);
      border-radius: 16px;
      padding: 12px 18px 56px 18px;
      color: var(--text-main);
      font-size: 1em;
      position: relative;
      min-height: 80px;
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      box-shadow: none;
      font-family: inherit;
      line-height: 1.5;
      letter-spacing: 0.01em;
      margin-bottom: 0;
      word-break: break-word;
      gap: 18px;
      overflow: hidden;
    }
    .inventory-list li .item-icon {
      flex: 0 0 40px;
      width: 40px;
      height: 40px;
      margin-top: 4px;
      background-size: contain;
      background-repeat: no-repeat;
      filter: drop-shadow(0 2px 8px rgba(6,234,211,0.12));
    }
    .inventory-list li .item-info {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      min-width: 0;
      position: relative;
      width: 100%;
    }
    .inventory-list li .item-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 100%;
      gap: 10px;
    }
    .inventory-list li .item-name {
      flex: 1 1 0;
      font-size: 1em;
      font-weight: 600;
      margin-bottom: 2px;
      display: block;
      word-break: break-word;
      min-width: 0;
    }
    .inventory-list li .item-actions {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
    }
    .inventory-list li .sell-btn {
      display: inline-block;
      min-width: 80px;
      max-width: 100%;
      margin: 0;
      padding: 8px 18px;
      font-size: 1em;
      text-align: center;
      pointer-events: auto;
      z-index: 2;
      border-radius: 10px;
      background: rgba(255,255,255,0.22);
      color: var(--accent);
      border: 1px solid var(--accent2);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
      box-shadow: none;
      word-break: break-word;
    }
    .inventory-list li .sell-btn:hover {
      background: var(--accent2);
      color: #fff;
    }
    .inventory-list li .rarity-badge {
      display: inline-block;
      font-size: 0.8em;
      font-weight: 500;
      border-radius: 6px;
      padding: 2px 10px;
      margin-bottom: 2px;
      margin-right: 8px;
      vertical-align: middle;
      color: #fff;
      background: linear-gradient(90deg, #FFD700 0%, #FFB300 100%);
      border: none;
    }
    .inventory-list li .rarity-badge.epic {
      background: linear-gradient(90deg, #a259f7 0%, #7b2ff2 100%);
    }
    .inventory-list li .rarity-badge.common {
      background: linear-gradient(90deg, #A4FEFD 0%, #06EAD3 100%);
      color: #0B0E26;
    }
    .inventory-list li .item-price {
      font-size: 0.9em;
      color: var(--accent2);
      margin-bottom: 2px;
      margin-right: 8px;
      vertical-align: middle;
      opacity: 0.8;
      font-weight: 500;
    }
    .inventory-list li.empty {
      text-align: center;
      color: #888;
      font-style: italic;
      background: none;
      box-shadow: none;
      padding-left: 0;
    }
    /* Меню-кнопки */
    #menu {
      position: fixed;
      bottom: 24px;
      left: 0;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      z-index: 1100;
      pointer-events: none;
      gap: 12px;
      padding: 0 10vw;
      box-sizing: border-box;
      transition: opacity 0.2s;
    }
    #menu .icon-btn {
      background: var(--glass-bg);
      border: 2.5px solid var(--accent2);
      border-radius: 50%;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.6em;
      color: var(--accent);
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.18s, transform 0.13s;
      box-shadow: var(--shadow); /* повертаємо стандартну тінь */
      outline: none;
      position: relative;
      margin: 0 8px;
      pointer-events: auto;
    }
    #menu .icon-btn:hover {
      background: var(--accent2);
      color: #fff;
      box-shadow: 0 0 40px 8px #A4FEFD, 0 8px 32px 0 rgba(6,234,211,0.18), 0 2px 0 #A4FEFD;
      transform: translateY(-4px) scale(1.12);
    }
    #menu .icon-btn:active {
      background: var(--accent);
      color: #fff;
      transform: scale(0.98);
      box-shadow: 0 0 18px 4px #06EAD3, 0 2px 8px 0 rgba(6,234,211,0.12), 0 1px 0 #06EAD3;
    }
    #menu .icon-btn svg {
      width: 48px;
      height: 48px;
      display: block;
    }
    #menu .icon-btn .emoji {
      font-size: 2em;
      line-height: 1;
    }
    .inventory-container.fullscreen ~ #menu {
      opacity: 0;
      pointer-events: none;
    }
    /* Адаптивність */
    @media (max-width: 900px) {
      #hud {
        top: 10px;
        left: 10px;
        padding: 14px 10px;
      }
      .inventory-container {
        top: 10px;
        right: 10px;
        min-width: 180px;
        max-width: 95vw;
        padding: 14px 10px 10px 10px;
      }
      #menu {
        padding: 0 2vw;
      }
      #menu .icon-btn {
        font-size: 1.5em;
        width: 60px;
        height: 60px;
        margin: 0 4px;
      }
      #menu .icon-btn svg {
        width: 32px;
        height: 32px;
      }
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.1em;
        margin: 10px 0 10px 0;
      }
      #hud {
        min-width: 90px;
        padding: 8px 4px;
        top: 4px;
        left: 4px;
        font-size: 0.9em;
      }
      .inventory-container {
        min-width: 80px;
        max-width: 98vw;
        padding: 8px 2px 8px 2px;
        top: 4px;
        right: 4px;
      }
      .inventory-container.fullscreen {
        padding: 24px 2vw 24px 2vw;
      }
      #menu {
        bottom: 4px;
        padding: 0 1vw;
      }
      #menu .icon-btn {
        font-size: 1.1em;
        width: 44px;
        height: 44px;
        margin: 0 2px;
      }
      #menu .icon-btn svg {
        width: 22px;
        height: 22px;
      }
      .inventory-list li {
        font-size: 0.95em;
        min-height: 36px;
        padding: 10px 10px 10px 38px;
      }
      .inventory-list li .item-icon {
        width: 22px;
        height: 22px;
        left: 8px;
      }
    }
    /* Стиль для кнопки екіпірувати */
    .equip-btn {
      display: inline-block;
      margin-top: 10px;
      margin-bottom: 0;
      margin-left: 0;
      padding: 8px 28px;
      font-size: 1em;
      border-radius: 22px;
      background: linear-gradient(90deg, #FFD700 0%, #FFB300 100%);
      color: #232946;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, box-shadow 0.18s;
      box-shadow: 0 2px 12px 0 rgba(255,215,0,0.18);
      min-width: 120px;
      max-width: 100%;
      text-align: center;
    }
    .equip-btn:hover {
      background: linear-gradient(90deg, #FFB300 0%, #FFD700 100%);
      color: #fff;
      box-shadow: 0 4px 18px 0 rgba(255,215,0,0.28);
    }
    .equip-btn.equipped {
      background: #bfc2c7;
      color: #232946;
      box-shadow: 0 2px 8px 0 rgba(100,100,100,0.10);
    }
    .equip-btn.equipped:hover {
      background: #a0a3a8;
      color: #fff;
    }
    .equip-btn:disabled {
      background: #bfc2c7;
      color: #232946;
      cursor: default;
      opacity: 0.8;
    }
    /* Підсвічування предметів у маркетплейсі за рідкістю */
    .market-legendary {
      border: 2.5px solid gold !important;
      box-shadow: 0 0 18px 2px gold !important;
      animation: gold-glow 1.5s infinite alternate;
    }
    .market-epic {
      border: 2.5px solid #a259f7 !important;
      box-shadow: 0 0 18px 2px #a259f7 !important;
      animation: epic-glow 1.5s infinite alternate;
    }
    .market-common {
      border: 2.5px solid #06EAD3 !important;
      box-shadow: 0 0 18px 2px #06EAD3 !important;
      animation: common-glow 1.5s infinite alternate;
    }
    @keyframes gold-glow {
      from { box-shadow: 0 0 8px 1px gold; }
      to { box-shadow: 0 0 24px 6px gold; }
    }
    @keyframes epic-glow {
      from { box-shadow: 0 0 8px 1px #a259f7; }
      to { box-shadow: 0 0 24px 6px #a259f7; }
    }
    @keyframes common-glow {
      from { box-shadow: 0 0 8px 1px #06EAD3; }
      to { box-shadow: 0 0 24px 6px #06EAD3; }
    }
    /* Покращена кнопка Купити */
    .buy-btn {
      background: linear-gradient(90deg, #06EAD3 0%, #A4FEFD 100%);
      color: #181c24;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      padding: 10px 28px;
      font-size: 1.08em;
      margin-left: 12px;
      cursor: pointer;
      box-shadow: 0 2px 12px 0 rgba(6,234,211,0.18);
      transition: background 0.18s, color 0.18s, box-shadow 0.18s, transform 0.13s;
      outline: none;
      position: relative;
      z-index: 1;
    }
    .buy-btn:hover:not(:disabled) {
      background: linear-gradient(90deg, #FFD700 0%, #FFB300 100%);
      color: #232946;
      box-shadow: 0 4px 18px 0 rgba(255,215,0,0.28);
      transform: scale(1.04);
    }
    .buy-btn:disabled {
      background: #bfc2c7;
      color: #232946;
      cursor: not-allowed;
      opacity: 0.7;
    }
    /* Кастомний tooltip для кнопок меню */
    .custom-tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 16px;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease, box-shadow 0.3s;
      box-shadow: 0 0 18px 4px #06EAD3, 0 0 8px 2px #A4FEFD;
      text-shadow: 0 0 8px #06EAD3, 0 0 2px #fff;
    }
    .custom-tooltip.active {
      opacity: 1;
      box-shadow: 0 0 32px 8px #06EAD3, 0 0 16px 4px #A4FEFD;
      text-shadow: 0 0 16px #06EAD3, 0 0 4px #fff;
    }
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      z-index: 10000;
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      animation: slideInDown 0.5s ease-out;
    }
    @keyframes slideInDown {
      from {
        transform: translateX(-50%) translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }
    .bubble {
      position: absolute;
      width: 32px;
      height: 32px;
      background: radial-gradient(circle at 30% 30%, #A4FEFD 80%, #06EAD3 100%, transparent 100%);
      border-radius: 50%;
      opacity: 0.7;
      pointer-events: none;
      animation: bubble-fly 1.2s linear forwards;
    }
    @keyframes bubble-fly {
      0% {
        opacity: 0.7;
        transform: scale(0.7) translate(0,0);
      }
      80% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
        transform: scale(1.2) translate(var(--tx, 0px), var(--ty, 0px));
      }
    }
    #marketplace-list {
      max-height: 50vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 0;
      margin: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--accent2) rgba(0,0,0,0.1);
    }
    #pet img {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }
    #blur-overlay {
      position: absolute;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      background: rgba(0,0,0,0.08);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      opacity: 0;
      transition: opacity 0.18s;
    }
    #blur-overlay.active {
      opacity: 1;
    }
    .rarity-badge.neon {
      background: linear-gradient(90deg, #00fff0 0%, #a259f7 100%);
      color: #fff;
      box-shadow: 0 0 12px 2px #00fff0, 0 0 24px 4px #a259f7;
      text-shadow: 0 0 8px #00fff0, 0 0 2px #fff;
    }
    .market-neon {
      border: 2.5px solid #00fff0 !important;
      box-shadow: 0 0 18px 2px #00fff0, 0 0 32px 8px #a259f7 !important;
      animation: neon-glow 1.5s infinite alternate;
    }
    @keyframes neon-glow {
      from { box-shadow: 0 0 8px 1px #00fff0; }
      to { box-shadow: 0 0 32px 8px #a259f7; }
    }
    @keyframes neon-pulse {
      from { box-shadow: 0 0 32px 8px #00fff0, 0 0 64px 16px #a259f7; }
      to { box-shadow: 0 0 64px 16px #00fff0, 0 0 128px 32px #a259f7; }
    }
  </style>
</head>
<body>
  <div id="blur-overlay"></div>
  <div style="display:flex; align-items:center; gap:18px; margin-top:32px;">
    <h1 style="margin:0;">TamagIRYS</h1>
    <div id="discord-user-info" style="display:none; background:rgba(0,0,0,0.18); border-radius:16px; padding:8px 18px; display:flex; align-items:center; gap:10px; position:static;">
      <img id="discord-avatar" src="" alt="avatar" style="width:32px; height:32px; border-radius:50%; background:#232946;">
      <span id="discord-username" style="color:var(--accent2); font-weight:600;"></span>
    </div>
  </div>
  <div id="hud" class="glass">
    <div class="hud-row"><span class="hud-label">⚡️Енергія</span><span class="hud-value" id="energy">100%</span></div>
    <div class="hud-row"><span class="hud-label">🌞Настрій</span><span class="hud-value" id="mood">Щасливий</span></div>
    <div class="hud-row"><span class="hud-label">💥XP</span><span class="hud-value" id="xp">0</span></div>
    <div class="hud-row"><span class="hud-label">💧Чистота</span><span class="hud-value" id="cleanliness">Чисто</span></div>
    <div class="hud-row" style="margin-top:8px; color:var(--accent2); font-size:1.05em;">
      <span id="xp-per-train">+10 XP за тренування</span>
    </div>
  </div>
  <div id="inventory" class="inventory-container glass">
    <div id="inventory-backdrop" class="inventory-fullscreen-backdrop" style="display:none;"></div>
    <div class="inventory-header" id="inventoryHeader" style="display:none;">
      <h2>Інвентар</h2>
      <button class="expand-btn" id="expandInventoryBtn" title="Розгорнути/Згорнути інвентар">✖</button>
    </div>
    <ul id="inventory-list" class="inventory-list"></ul>
  </div>
  <div id="pet" style="margin-top: 120px; margin-bottom: 32px; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; background: none; box-shadow: none; border: none; position: relative;">
    <div id="blur-overlay"></div>
    <img id="pet-img" src="pet.png" alt="pet" style="width: 400px; height: 400px; border-radius: 0; box-shadow: none; object-fit: contain; background: none;">
    <div class="sparkles" id="pet-sparkles" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:2;">
      <svg width="100%" height="100%" viewBox="0 0 180 180">
        <g>
          <circle cx="40" cy="60" r="8" fill="#A4FEFD" opacity="0.8">
            <animate attributeName="r" values="8;16;8" dur="1.2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.8;0.2;0.8" dur="1.2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="120" cy="40" r="6" fill="#06EAD3" opacity="0.7">
            <animate attributeName="r" values="6;12;6" dur="1.1s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.7;0.2;0.7" dur="1.1s" repeatCount="indefinite"/>
          </circle>
          <circle cx="90" cy="120" r="10" fill="#fff" opacity="0.5">
            <animate attributeName="r" values="10;18;10" dur="1.3s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.5;0.1;0.5" dur="1.3s" repeatCount="indefinite"/>
          </circle>
        </g>
      </svg>
    </div>
    <div class="bubbles" id="pet-bubbles" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:3;"></div>
  </div>
  <div id="menu" class="menu">
    <button class="icon-btn" onclick="feedPet()" title="Годувати">
      <i class="bi bi-egg-fried"></i>
    </button>
    <button class="icon-btn" onclick="sleepPet()" title="Спати">
      <i class="bi bi-moon"></i>
    </button>
    <button class="icon-btn" onclick="cleanPet()" title="Чистити">
      <i class="bi bi-droplet"></i>
    </button>
    <button class="icon-btn" onclick="trainPet()" title="Тренувати">
      <i class="bi bi-lightning"></i>
    </button>
    <button class="icon-btn" onclick="openInventory()" title="Інвентар">
      <i class="bi bi-bag"></i>
    </button>
    <button class="icon-btn" onclick="openMarketplace()" title="Маркетплейс"><i class="bi bi-archive"></i></button>
    <button class="icon-btn" onclick="openRulesModal()" title="Правила і цікаві факти"><i class="bi bi-asterisk"></i></button>
    <button class="icon-btn" onclick="openAuthorsModal()" title="Автори"><i class="bi bi-balloon-heart"></i></button>
  </div>

  <!-- Вікно маркетплейсу -->
  <div id="marketplace-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.55); z-index:3000; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:600px; width:96vw; margin:auto; border-radius:24px; padding:32px 18px 24px 18px; position:relative;">
      <button onclick="closeMarketplace()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">✖</button>
      <h2 style="color:var(--accent2); margin-top:0;">Маркетплейс</h2>
      <ul id="marketplace-list" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:18px;"></ul>
    </div>
  </div>

  <!-- Вікно інвентаря -->
  <div id="inventory-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.55); z-index:3000; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:700px; width:96vw; margin:auto; border-radius:24px; padding:32px 18px 24px 18px; position:relative; max-height:90vh; overflow-y:auto;">
      <button onclick="closeInventory()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">✖</button>
      <h2 style="color:var(--accent2); margin-top:0;">🎒 Інвентар</h2>
      <div style="margin-bottom:20px; color:var(--text-soft);">
        <span id="inventory-count">Предметів: 0</span>
      </div>
      <ul id="inventory-modal-list" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:18px;"></ul>
    </div>
  </div>

  <!-- Модальне вікно Discord-логіну -->
  <div id="discord-login-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:5000; align-items:center; justify-content:center;">
    <div class="glass" style="padding:48px 32px; border-radius:24px; text-align:center; max-width:350px; width:90vw;">
      <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord" style="width:64px; height:64px; margin-bottom:18px;">
      <h2 style="color:var(--accent2); margin:0 0 18px 0;">Увійдіть через Discord</h2>
      <p style="color:var(--text-soft); margin-bottom:24px;">Щоб грати, авторизуйтеся через Discord</p>
      <a href="/auth/discord" style="background:#5865F2; color:#fff; font-size:1.1em; border:none; border-radius:12px; padding:14px 32px; font-weight:700; cursor:pointer; text-decoration:none; display:inline-block;">Увійти через Discord</a>
    </div>
  </div>

  <!-- Модальне вікно правил і фактів -->
  <div id="rules-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.65); z-index:4000; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:700px; width:96vw; margin:auto; border-radius:24px; padding:36px 28px 28px 28px; position:relative; overflow-y:auto; max-height:90vh;">
      <button onclick="closeRulesModal()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">✖</button>
      <h2 style="color:var(--accent2); margin-top:0;">📚 Правила та цікаві факти</h2>
      <div style="color:var(--text-main); font-size:1.08em; line-height:1.7;">
        <h3 style="color:var(--accent2); margin-top:20px;">🎮 Основні правила:</h3>
        <ul>
          <li>Годуйте IRYS щоб підтримувати енергію</li>
          <li>Кладіть спати для відновлення сил</li>
          <li>Чистіть IRYS щоб підтримувати гігієну</li>
          <li>Тренуйтеся для отримання XP</li>
          <li>Досліджуйте світ щоб знаходити предмети</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">😊 Настрій IRYS:</h3>
        <ul>
          <li><strong>Щасливий</strong> - IRYS готова до тренування та всіх активностей</li>
          <li><strong>Сонний</strong> - енергія низька, тренування недоступне</li>
          <li><strong>Поганий</strong> - IRYS брудна, тренування недоступне</li>
          <li><strong>Дуже поганий</strong> - низька енергія + брудно, тренування недоступне</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">⚡ Випадкові події:</h3>
        <ul>
          <li>При кожній дії є 15% шанс випадкової події</li>
          <li><strong>Позитивні події:</strong> додаткові XP, енергія, предмети, покращення настрою</li>
          <li><strong>Негативні події:</strong> погіршення настрою, втрата енергії</li>
          <li>Події роблять гру більш непередбачуваною та цікавою</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">💎 Система предметів:</h3>
        <ul>
          <li><strong>Камонка</strong> - звичайні предмети (70% шанс)</li>
          <li><strong>Пурпурна</strong> - епічні предмети (25% шанс)</li>
          <li><strong>Золота</strong> - легендарні предмети (5% шанс)</li>
          <li>Можна екіпірувати до 3 легендарних предметів одночасно</li>
          <li>Легендарні предмети дають бонус XP за тренування</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">🏪 Маркетплейс:</h3>
        <ul>
          <li>Предмети коштують в 10 разів більше ніж їх базова ціна</li>
          <li>Це стимулює заробляти предмети через дослідження</li>
          <li>Можна продавати зайві предмети</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">🎯 Поради для гравців:</h3>
        <ul>
          <li>Слідкуйте за настроєм IRYS - він впливає на можливості</li>
          <li>Тренуйтеся тільки коли IRYS щаслива</li>
          <li>Зберігайте легендарні предмети для максимального бонусу XP</li>
          <li>Випадкові події можуть як допомогти, так і зашкодити</li>
          <li>Регулярно досліджуйте світ для отримання предметів</li>
        </ul>
        
        <h3 style="color:var(--accent2); margin-top:20px;">🔗 Корисні посилання:</h3>
        <ul>
          <li><a href="https://discord.gg/irys" target="_blank" style="color:var(--accent2);">Discord сервер IRYS</a></li>
          <li><a href="https://www.youtube.com/@IRyS" target="_blank" style="color:var(--accent2);">YouTube канал IRYS</a></li>
          <li><a href="https://twitter.com/irys_en" target="_blank" style="color:var(--accent2);">Twitter IRYS</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Модальне вікно авторів -->
  <div id="authors-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.65); z-index:4100; align-items:center; justify-content:center;">
    <div class="glass" style="max-width:420px; width:92vw; margin:auto; border-radius:24px; padding:36px 28px 28px 28px; position:relative; overflow-y:auto; max-height:90vh; text-align:center;">
      <button onclick="closeAuthorsModal()" style="position:absolute; top:12px; right:18px; font-size:1.5em; background:none; border:none; color:#fff; cursor:pointer;">✖</button>
      <h2 style="color:var(--accent2); margin-top:0;">Автор гри</h2>
      <div style="color:var(--text-main); font-size:1.12em; line-height:1.7; margin-bottom:18px;">Цей проєкт створив:</div>
      <div style="display:flex; flex-direction:column; align-items:center; gap:18px;">
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord" style="width:32px; height:32px;">
          <span style="font-weight:600; color:#A4FEFD;">@megymin</span>
        </div>
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733553.png" alt="GitHub" style="width:32px; height:32px;">
          <a href="https://github.com/gerberaa" target="_blank" style="color:#A4FEFD; font-weight:600; text-decoration:underline;">github.com/gerberaa</a>
        </div>
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram" style="width:32px; height:32px;">
          <a href="https://t.me/megymin_xz" target="_blank" style="color:#A4FEFD; font-weight:600; text-decoration:underline;">@megymin_xz</a>
        </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div id="custom-tooltip" class="custom-tooltip"></div>
  <div id="notification" class="notification" style="display: none;"></div>

  <script>
    let xp = 0;
    let inventory = {}; // {назва: кількість}
    let equippedLegendaryItems = []; // Масив екіпірованих золотих речей
    let equippedItems = [];

    // --- Опис предметів з рідкістю та ціною ---
    const itemData = [
      { name: 'NFT Шапка', rarity: 'common', price: 100, icon: 'asets/Шапка.png' },
      { name: 'NFT Сонцезахисні окуляри', rarity: 'epic', price: 499, icon: 'asets/ОЧКІ.png' },
      { name: 'NFT Костюм', rarity: 'legendary', price: 3000, icon: 'asets/КОСТЮМ.png' },
      { name: 'NFT Кросівки', rarity: 'common', price: 100, icon: 'asets/КРОСІВКИ ЙОУ.png' },
      { name: 'NFT Годинник', rarity: 'epic', price: 499, icon: 'asets/РОЛІКСИ.png' },
      { name: 'NFT Рюкзак', rarity: 'common', price: 100, icon: 'asets/РЮКЗАК НАХ.png' },
      { name: 'NFT Пояс', rarity: 'common', price: 100, icon: 'asets/ПОЯС.png' },
      { name: 'NFT Плащ', rarity: 'epic', price: 499, icon: 'asets/ПЛАЩ.png' },
      { name: 'NFT Кулон', rarity: 'legendary', price: 3000, icon: 'asets/КУЛОН.png' },
      { name: 'NFT Кепка', rarity: 'common', price: 100, icon: 'asets/КЕПКА.png' },
      { name: 'NFT Перстень', rarity: 'epic', price: 499, icon: 'asets/ПЕРСТЕНЬ.png' },
      { name: 'Галактична NFT', rarity: 'neon', price: 1000000, icon: 'asets/galaxy.png' },
    ];
    const allItems = itemData.map(i => i.name);
    const itemMap = Object.fromEntries(itemData.map(i => [i.name, i]));

    function getRandomItem() {
      // Випадати можуть тільки предмети, крім Галактична NFT
      const legendary = itemData.filter(i => i.rarity === 'legendary' && i.name !== 'Галактична NFT');
      const epic = itemData.filter(i => i.rarity === 'epic');
      const common = itemData.filter(i => i.rarity === 'common');
      const rand = Math.random();
      if (rand < 0.05) { // 5% легендарна
        return legendary[Math.floor(Math.random() * legendary.length)].name;
      } else if (rand < 0.25) { // 20% епічна
        return epic[Math.floor(Math.random() * epic.length)].name;
      } else { // 75% камонка
        return common[Math.floor(Math.random() * common.length)].name;
      }
    }

    function updateInventoryUI() {
      const list = document.getElementById('inventory-list');
      list.innerHTML = '';
      const items = Object.keys(inventory);
      if (items.length === 0) {
        const li = document.createElement('li');
        li.innerText = 'Порожньо';
        li.className = 'empty';
        list.appendChild(li);
      } else {
        items.forEach((item) => {
          const data = itemMap[item];
          const li = document.createElement('li');
          if (data.rarity === 'legendary' && equippedLegendaryItems.includes(item)) {
            li.style.border = '2.5px solid gold';
            li.style.boxShadow = '0 0 16px 0 gold';
          }
          const icon = document.createElement('span');
          icon.className = 'item-icon';
          icon.style.backgroundImage = `url('${data.icon}')`;
          const info = document.createElement('div');
          info.className = 'item-info';
          if (data.rarity === 'legendary' || data.rarity === 'neon') {
            const row = document.createElement('div');
            row.className = 'item-row';
            const sellBtn = document.createElement('button');
            sellBtn.innerText = 'Продати';
            sellBtn.className = 'sell-btn';
            sellBtn.onclick = function() { confirmSell(item); };
            const nameSpan = document.createElement('span');
            nameSpan.innerText = data.name + (inventory[item] > 1 ? ` ×${inventory[item]}` : '');
            nameSpan.className = 'item-name';
            const equipBtn = document.createElement('button');
            const isEquipped = equippedLegendaryItems.includes(item);
            equipBtn.innerText = isEquipped ? 'Зняти' : 'Екіпірувати';
            equipBtn.className = 'equip-btn' + (isEquipped ? ' equipped' : '');
            if (!isEquipped && equippedLegendaryItems.length >= 3) {
              equipBtn.disabled = true;
              equipBtn.title = 'Можна екіпірувати лише 3 предмети';
            }
            equipBtn.onclick = function() {
              if (isEquipped) {
                equippedLegendaryItems = equippedLegendaryItems.filter(x => x !== item);
              } else {
                if (equippedLegendaryItems.length < 3) {
                  equippedLegendaryItems.push(item);
                }
              }
              updateInventoryUI();
              updateTrainXPUI();
              saveUserData();
            };
            row.appendChild(sellBtn);
            row.appendChild(nameSpan);
            row.appendChild(equipBtn);
            info.appendChild(row);
          } else {
            const nameSpan = document.createElement('span');
            nameSpan.innerText = data.name + (inventory[item] > 1 ? ` ×${inventory[item]}` : '');
            nameSpan.className = 'item-name';
            info.appendChild(nameSpan);
            const sellBtn = document.createElement('button');
            sellBtn.innerText = 'Продати';
            sellBtn.className = 'sell-btn';
            sellBtn.style.marginTop = '8px';
            sellBtn.onclick = function() { confirmSell(item); };
            info.appendChild(sellBtn);
          }
          const badge = document.createElement('span');
          badge.className = 'rarity-badge ' + data.rarity;
          badge.innerText = data.rarity === 'neon' ? 'Неонова' : (data.rarity === 'legendary' ? 'Золота' : (data.rarity === 'epic' ? 'Пурпурна' : 'Камонка'));
          info.appendChild(badge);
          const price = document.createElement('span');
          price.className = 'item-price';
          price.innerText = `${data.price} XP`;
          info.appendChild(price);
          li.appendChild(icon);
          li.appendChild(info);
          list.appendChild(li);
        });
      }
      updateTrainXPUI();
    }

    function confirmSell(item) {
      const data = itemMap[item];
      if (confirm(`Продати ${data.name} (${data.rarity === 'legendary' ? 'Золота' : (data.rarity === 'epic' ? 'Пурпурна' : 'Камонка')}) за ${data.price} XP?`)) {
        sellItem(item);
      }
    }

    function sellItem(item) {
      const data = itemMap[item];
      if (inventory[item] > 1) {
        inventory[item]--;
      } else {
        delete inventory[item];
        equippedLegendaryItems = equippedLegendaryItems.filter(x => x !== item);
      }
      xp += data.price;
      document.getElementById('xp').innerText = xp;
      updateInventoryUI();
      saveUserData();
    }

    // --- Автоматичне зниження енергії та чистоти ---
    let energyInterval, cleanlinessInterval;

    function isGalaxyEquipped() {
      return equippedLegendaryItems.includes('Галактична NFT');
    }

    // Оновлюю getTrainXP
    function getTrainXP() {
      if (isGalaxyEquipped()) return 100000000000;
      let sum = 0;
      for (const item of equippedLegendaryItems) {
        if (itemMap[item] && itemMap[item].rarity === 'legendary') {
          sum += itemMap[item].price;
        }
      }
      if (sum >= 8000) return 10000;
      if (sum >= 4000) return 1000;
      if (sum >= 2000) return 100;
      return 10;
    }

    // Оновлюю updatePetState
    function updatePetState() {
      if (isGalaxyEquipped()) {
        document.getElementById('energy').innerText = '100%';
        document.getElementById('cleanliness').innerText = 'Чисто';
        document.getElementById('mood').innerText = 'Щасливий';
        updateTrainButton();
        return;
      }
      let energy = parseInt(document.getElementById('energy').innerText);
      let cleanliness = document.getElementById('cleanliness').innerText;
      let mood = 'Щасливий';
      if (energy < 100 || cleanliness !== 'Чисто') mood = 'Сонний';
      if (cleanliness === 'Брудно') mood = 'Поганий';
      if (energy <= 20 && cleanliness === 'Брудно') mood = 'Дуже поганий';
      if (energy === 100 && cleanliness === 'Чисто') mood = 'Щасливий';
      document.getElementById('mood').innerText = mood;
      updateTrainButton();
    }

    // Оновлюю startPetTimers
    function startPetTimers() {
      energyInterval = setInterval(() => {
        if (isGalaxyEquipped()) {
          document.getElementById('energy').innerText = '100%';
          updatePetState();
          saveUserData();
          return;
        }
        let energy = parseInt(document.getElementById('energy').innerText);
        if (isNaN(energy)) energy = 100;
        energy = Math.max(0, energy - 10);
        document.getElementById('energy').innerText = energy + '%';
        updatePetState();
        saveUserData();
      }, 30000);
      cleanlinessInterval = setInterval(() => {
        if (isGalaxyEquipped()) {
          document.getElementById('cleanliness').innerText = 'Чисто';
          updatePetState();
          saveUserData();
          return;
        }
        let cleanliness = document.getElementById('cleanliness').innerText;
        if (cleanliness === 'Чисто') {
          document.getElementById('cleanliness').innerText = 'Трохи брудно';
        } else if (cleanliness === 'Трохи брудно') {
          document.getElementById('cleanliness').innerText = 'Брудно';
        }
        updatePetState();
        saveUserData();
      }, 30000);
    }

    // Перезапускати таймери при завантаженні
    window.addEventListener('DOMContentLoaded', () => {
      startPetTimers();
    });

    function setPetSprite(sprite) {
      const petImg = document.querySelector('#pet img');
      if (!petImg) return;
      petImg.src = sprite;
    }
    function animatePet(sprite) {
      setPetSprite(sprite);
      setTimeout(() => setPetSprite('pet.png'), 2000);
    }

    function showScreenBlur() {
      const blur = document.getElementById('blur-overlay');
      if (!blur) return;
      blur.classList.add('active');
      setTimeout(() => blur.classList.remove('active'), 300);
    }

    // Всі дії (feedPet, sleepPet, cleanPet, trainPet, explorePet) після своєї логіки роблять:
    function enforceGalaxyGodMode() {
      if (isGalaxyEquipped()) {
        document.getElementById('energy').innerText = '100%';
        document.getElementById('cleanliness').innerText = 'Чисто';
        document.getElementById('mood').innerText = 'Щасливий';
        updateTrainXPUI();
        updateTrainButton();
      }
    }

    // --- feedPet ---
    function feedPet() {
      showScreenBlur();
      let energy = parseInt(document.getElementById('energy').innerText);
      energy = Math.min(100, energy + 15);
      document.getElementById('energy').innerText = energy + '%';
      animatePet('food.png');
      updatePetState();
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- sleepPet ---
    function sleepPet() {
      showScreenBlur();
      let energy = parseInt(document.getElementById('energy').innerText);
      energy = Math.min(100, energy + 25);
      document.getElementById('energy').innerText = energy + '%';
      animatePet('zzz.png');
      updatePetState();
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- cleanPet ---
    function cleanPet() {
      showScreenBlur();
      let cleanliness = document.getElementById('cleanliness').innerText;
      if (cleanliness === 'Брудно') {
        document.getElementById('cleanliness').innerText = 'Трохи брудно';
      } else if (cleanliness === 'Трохи брудно') {
        document.getElementById('cleanliness').innerText = 'Чисто';
      }
      const sparkles = document.getElementById('pet-sparkles');
      if (sparkles) {
        sparkles.style.display = 'block';
        setTimeout(() => { sparkles.style.display = 'none'; }, 1500);
      }
      const bubbles = document.getElementById('pet-bubbles');
      if (bubbles) {
        bubbles.innerHTML = '';
        for (let i = 0; i < 8; i++) {
          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          const x = 80 + Math.random()*20;
          const y = 120 + Math.random()*20;
          bubble.style.left = x + 'px';
          bubble.style.top = y + 'px';
          const angle = Math.random() * 2 * Math.PI;
          const dist = 80 + Math.random()*60;
          const tx = Math.cos(angle) * dist;
          const ty = Math.sin(angle) * dist;
          bubble.style.setProperty('--tx', tx+'px');
          bubble.style.setProperty('--ty', ty+'px');
          bubbles.appendChild(bubble);
        }
        bubbles.style.display = 'block';
        setTimeout(() => { bubbles.style.display = 'none'; bubbles.innerHTML = ''; }, 1500);
      }
      const petImg = document.getElementById('pet-img');
      if (petImg) petImg.src = 'pet.png';
      updatePetState();
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- trainPet ---
    function trainPet() {
      showScreenBlur();
      const mood = document.getElementById('mood').innerText;
      if (mood === 'Сонний' || mood === 'Поганий' || mood === 'Дуже поганий') {
        showNotification('IRYS не може тренуватися з поганим настроєм! Спочатку покорми, почисти або поклади спати.');
        enforceGalaxyGodMode();
        saveUserData();
        return;
      }
      const trainXP = getTrainXP();
      xp += trainXP;
      document.getElementById('xp').innerText = xp;
      updateTrainXPUI();
      animatePet('geam.png');
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }
    // --- explorePet ---
    function explorePet() {
      const casePrice = 10000;
      if (xp < casePrice && !isGalaxyEquipped()) {
        showNotification(`Потрібно мінімум ${casePrice} XP для відкриття кейсу!`);
        saveUserData();
        return;
      }
      if (!isGalaxyEquipped()) xp -= casePrice;
      document.getElementById('xp').innerText = xp;
      const foundItem = getRandomItem();
      if (!inventory[foundItem]) {
        inventory[foundItem] = 0;
      }
      inventory[foundItem]++;
      updateInventoryUI();
      // --- Анімація зірочок над петом ---
      animatePet('pet.png');
      showStarsAbovePet();
      showNotification(`Ви знайшли: ${foundItem} (${itemMap[foundItem].rarity === 'neon' ? 'Неонова' : (itemMap[foundItem].rarity === 'legendary' ? 'Золота' : (itemMap[foundItem].rarity === 'epic' ? 'Пурпурна' : 'Камонка'))})`);
      triggerRandomEvent();
      enforceGalaxyGodMode();
      saveUserData();
    }

    // Додаю функцію showStarsAbovePet
    function showStarsAbovePet() {
      let pet = document.getElementById('pet');
      if (!pet) return;
      let starsContainer = document.createElement('div');
      starsContainer.style.position = 'absolute';
      starsContainer.style.left = '0';
      starsContainer.style.top = '0';
      starsContainer.style.width = '100%';
      starsContainer.style.height = '100%';
      starsContainer.style.pointerEvents = 'none';
      starsContainer.style.zIndex = '10';
      for (let i = 0; i < 8; i++) {
        let star = document.createElement('div');
        star.style.position = 'absolute';
        star.style.left = (40 + Math.random()*100) + 'px';
        star.style.top = (60 + Math.random()*40) + 'px';
        star.style.width = '32px';
        star.style.height = '32px';
        star.style.background = 'none';
        star.style.backgroundImage = "url('https://cdn-icons-png.flaticon.com/512/616/616489.png')";
        star.style.backgroundSize = 'contain';
        star.style.backgroundRepeat = 'no-repeat';
        star.style.opacity = '0.9';
        star.style.transform = 'scale(0.7)';
        star.style.transition = 'none';
        star.style.pointerEvents = 'none';
        star.style.filter = 'drop-shadow(0 0 12px #FFD700)';
        // Анімація
        star.animate([
          { transform: 'scale(0.7) translateY(0)', opacity: 0.9 },
          { transform: 'scale(1.2) translateY(-120px)', opacity: 0.1 }
        ], {
          duration: 1200 + Math.random()*400,
          easing: 'cubic-bezier(.4,1.4,.6,1)',
          fill: 'forwards'
        });
        starsContainer.appendChild(star);
      }
      pet.appendChild(starsContainer);
      setTimeout(() => { if (starsContainer.parentNode) starsContainer.parentNode.removeChild(starsContainer); }, 1400);
    }
    // ---

    function openMarketplace() {
      document.getElementById('marketplace-modal').style.display = 'flex';
      renderMarketplace();
    }

    function closeMarketplace() {
      document.getElementById('marketplace-modal').style.display = 'none';
    }

    function renderMarketplace() {
      const list = document.getElementById('marketplace-list');
      list.innerHTML = '';
      itemData.forEach(item => {
        const li = document.createElement('li');
        li.style.display = 'flex';
        li.style.alignItems = 'center';
        li.style.gap = '18px';
        li.style.background = 'rgba(255,255,255,0.10)';
        li.style.borderRadius = '16px';
        li.style.padding = '12px 18px';
        // Підсвічування за рідкістю
        if (item.rarity === 'legendary') li.classList.add('market-legendary');
        else if (item.rarity === 'epic') li.classList.add('market-epic');
        else if (item.rarity === 'neon') li.classList.add('market-neon');
        else li.classList.add('market-common');
        // Іконка
        const icon = document.createElement('span');
        icon.className = 'item-icon';
        icon.style.backgroundImage = `url('${item.icon}')`;
        icon.style.width = '40px';
        icon.style.height = '40px';
        icon.style.backgroundSize = 'contain';
        icon.style.backgroundRepeat = 'no-repeat';
        icon.style.backgroundPosition = 'center';
        // Назва
        const name = document.createElement('span');
        name.innerText = item.name;
        name.style.fontWeight = '600';
        name.style.flex = '1 1 0';
        // Рідкість
        const badge = document.createElement('span');
        badge.className = 'rarity-badge ' + item.rarity;
        badge.innerText = item.rarity === 'neon' ? 'Неонова' : (item.rarity === 'legendary' ? 'Золота' : (item.rarity === 'epic' ? 'Пурпурна' : 'Камонка'));
        // Ціна (у 10 разів дорожче)
        const marketPrice = item.price * 10;
        const price = document.createElement('span');
        price.className = 'item-price';
        price.innerText = `${marketPrice} XP`;
        // Кількість у гравця
        const count = document.createElement('span');
        count.innerText = `У вас: ${inventory[item.name] || 0}`;
        count.style.color = 'var(--accent2)';
        count.style.fontSize = '0.95em';
        // Кнопка купити
        const buyBtn = document.createElement('button');
        buyBtn.innerText = 'Купити';
        buyBtn.className = 'buy-btn';
        buyBtn.disabled = xp < marketPrice;
        if (buyBtn.disabled) buyBtn.title = 'Недостатньо XP';
        buyBtn.onclick = function() { buyItemFromMarketplace(item.name, marketPrice); };
        li.appendChild(icon);
        li.appendChild(name);
        li.appendChild(badge);
        li.appendChild(price);
        li.appendChild(count);
        li.appendChild(buyBtn);
        list.appendChild(li);
      });
    }

    function buyItemFromMarketplace(itemName, marketPrice) {
      const item = itemMap[itemName];
      if (xp < marketPrice) return;
      xp -= marketPrice;
      if (inventory[itemName]) inventory[itemName]++;
      else inventory[itemName] = 1;
      document.getElementById('xp').innerText = xp;
      updateInventoryUI();
      renderMarketplace();
      saveUserData();
    }

    // --- API ---
    async function saveUserData() {
      const data = {
        xp,
        inventory,
        equippedLegendaryItems,
        energy: document.getElementById('energy').innerText,
        mood: document.getElementById('mood').innerText,
        cleanliness: document.getElementById('cleanliness').innerText
      };
      try {
        const res = await fetch('http://localhost:3000/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!res.ok) {
          if (res.status === 401) {
            showNotification('Дані не збережено! Потрібна авторизація через Discord.');
          } else {
            showNotification('Помилка збереження даних!');
          }
          console.error('Помилка збереження:', res.status, await res.text());
        }
      } catch (e) {
        showNotification('Помилка збереження! Сервер недоступний.');
        console.error('Помилка збереження:', e);
      }
    }

    async function loadUserData() {
      try {
        const res = await fetch('http://localhost:3000/load');
        if (!res.ok) return;
        const data = await res.json();
        console.log('Завантажені дані:', data);
        xp = data.xp || 0;
        inventory = data.inventory || {};
        equippedLegendaryItems = data.equippedLegendaryItems || [];
        console.log('Інвентар після завантаження:', inventory);
        document.getElementById('xp').innerText = xp;
        document.getElementById('energy').innerText = data.energy || '100%';
        document.getElementById('mood').innerText = data.mood || 'Щасливий';
        document.getElementById('cleanliness').innerText = data.cleanliness || 'Чисто';
        updateInventoryUI();
        updateTrainXPUI();
      } catch (e) {
        console.error('Помилка завантаження:', e);
      }
    }

    // --- Discord Login (OAuth2) ---
    async function checkDiscordAuth() {
      try {
        const res = await fetch('/me');
        const data = await res.json();
        if (data.loggedIn) {
          // Показати інфу користувача
          document.getElementById('discord-login-modal').style.display = 'none';
          document.getElementById('discord-user-info').style.display = 'flex';
          document.getElementById('discord-username').innerText = data.user.username;
          document.getElementById('discord-avatar').src = data.user.avatar ? `https://cdn.discordapp.com/avatars/${data.user.id}/${data.user.avatar}.png` : 'https://cdn-icons-png.flaticon.com/512/5968/5968756.png';
          loadUserData();
        } else {
          document.getElementById('discord-login-modal').style.display = 'flex';
          document.getElementById('discord-user-info').style.display = 'none';
        }
      } catch (e) {
        document.getElementById('discord-login-modal').style.display = 'flex';
        document.getElementById('discord-user-info').style.display = 'none';
      }
    }
    window.onload = checkDiscordAuth;

    // --- Логіка для розгортання/згортання інвентаря ---
    const inventoryContainer = document.getElementById('inventory');
    const expandBtn = document.getElementById('expandInventoryBtn');
    const inventoryBackdrop = document.getElementById('inventory-backdrop');
    const inventoryHeader = document.getElementById('inventoryHeader');
    let inventoryFullscreen = false;
    expandBtn.onclick = function() {
      inventoryFullscreen = !inventoryFullscreen;
      if (inventoryFullscreen) {
        inventoryContainer.classList.add('fullscreen');
        inventoryHeader.style.display = 'flex';
        expandBtn.innerText = '✖';
        expandBtn.title = 'Згорнути інвентар';
        inventoryBackdrop.style.display = 'block';
      } else {
        inventoryContainer.classList.remove('fullscreen');
        inventoryHeader.style.display = 'none';
        expandBtn.innerText = '⤢';
        expandBtn.title = 'Розгорнути інвентар';
        inventoryBackdrop.style.display = 'none';
      }
    };

    function openRulesModal() {
      document.getElementById('rules-modal').style.display = 'flex';
    }

    function closeRulesModal() {
      document.getElementById('rules-modal').style.display = 'none';
    }

    function openAuthorsModal() {
      document.getElementById('authors-modal').style.display = 'flex';
    }

    function closeAuthorsModal() {
      document.getElementById('authors-modal').style.display = 'none';
    }

    // Кастомний tooltip для кнопок меню
    const tooltip = document.getElementById('custom-tooltip');
    document.querySelectorAll('#menu .icon-btn').forEach(btn => {
      btn.addEventListener('mouseenter', function(e) {
        const text = btn.getAttribute('title');
        if (!text) return;
        tooltip.innerText = text;
        tooltip.classList.add('active');
        const rect = btn.getBoundingClientRect();
        tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 8) + 'px';
      });
      btn.addEventListener('mousemove', function(e) {
        const rect = btn.getBoundingClientRect();
        tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 8) + 'px';
      });
      btn.addEventListener('mouseleave', function() {
        tooltip.classList.remove('active');
      });
    });

    // Додаю функцію для оновлення стану кнопки тренування
    function updateTrainButton() {
      const trainBtn = document.querySelector('#menu .icon-btn[onclick="trainPet()"]');
      const mood = document.getElementById('mood').innerText;
      if (mood === 'Сонний' || mood === 'Поганий' || mood === 'Дуже поганий') {
        trainBtn.disabled = true;
        trainBtn.style.opacity = '0.5';
        trainBtn.title = 'IRYS не може тренуватися з поганим настроєм';
      } else {
        trainBtn.disabled = false;
        trainBtn.style.opacity = '1';
        trainBtn.title = 'Тренувати';
      }
    }

    // Функція для показу повідомлень на сайті
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.innerText = message;
      notification.style.display = 'block';
      
      // Автоматично приховуємо повідомлення через 4 секунди
      setTimeout(() => {
        notification.style.display = 'none';
      }, 4000);
    }

    // Система випадкових подій
    const events = [
      {
        name: "Ірсу приснилося жахіття",
        description: "Під час сну Ірсу приснилося жахіття, тому в неї весь день поганий настрій",
        effect: () => {
          document.getElementById('mood').innerText = 'Поганий';
          updateTrainButton();
        }
      },
      {
        name: "Ірсу знайшла скарб",
        description: "Під час дослідження Ірсу знайшла прихований скарб!",
        effect: () => {
          xp += 500;
          document.getElementById('xp').innerText = xp;
          showNotification("Ірсу знайшла скарб! +500 XP");
        }
      },
      {
        name: "Ірсу з'їла щось погане",
        description: "Ірсу з'їла щось не те, тепер вона почувається не добре",
        effect: () => {
          let energy = parseInt(document.getElementById('energy').innerText);
          energy = Math.max(0, energy - 30);
          document.getElementById('energy').innerText = energy;
          updatePetState();
        }
      },
      {
        name: "Ірсу зробила новий рекорд",
        description: "Під час тренування Ірсу встановила новий особистий рекорд!",
        effect: () => {
          xp += 200;
          document.getElementById('xp').innerText = xp;
          showNotification("Новий рекорд! +200 XP");
        }
      },
      {
        name: "Ірсу знайшла дивний камінь",
        description: "Під час прогулянки Ірсу знайшла дивний камінь, який світиться",
        effect: () => {
          xp += 150;
          document.getElementById('xp').innerText = xp;
          showNotification("Ірсу знайшла дивний камінь! +150 XP");
        }
      },
      {
        name: "Ірсу зробила фізичну вправу",
        description: "Ірсу зробила кілька фізичних вправ і почувається енергійніше",
        effect: () => {
          let energy = parseInt(document.getElementById('energy').innerText);
          energy = Math.min(100, energy + 20);
          document.getElementById('energy').innerText = energy;
          updatePetState();
          showNotification("Ірсу почувається енергійніше! +20 енергії");
        }
      },
      {
        name: "Ірсу знайшла квітку",
        description: "Ірсу знайшла красиву квітку і подарувала її вам",
        effect: () => {
          xp += 100;
          document.getElementById('xp').innerText = xp;
          showNotification("Ірсу знайшла красиву квітку! +100 XP");
        }
      },
      {
        name: "Ірсу зробила добру справу",
        description: "Ірсу допомогла комусь і почувається щасливою",
        effect: () => {
          document.getElementById('mood').innerText = 'Щасливий';
          updateTrainButton();
          showNotification("Ірсу зробила добру справу і щаслива!");
        }
      },
      {
        name: "Ірсу знайшла старий дневник",
        description: "Під час дослідження Ірсу знайшла старий дневник з цікавими історіями",
        effect: () => {
          xp += 300;
          document.getElementById('xp').innerText = xp;
          showNotification("Ірсу знайшла старий дневник! +300 XP");
        }
      },
      {
        name: "Ірсу зробила медитацію",
        description: "Ірсу зробила коротку медитацію і відновила спокій",
        effect: () => {
          let energy = parseInt(document.getElementById('energy').innerText);
          energy = Math.min(100, energy + 15);
          document.getElementById('energy').innerText = energy;
          updatePetState();
          showNotification("Ірсу відновила спокій після медитації! +15 енергії");
        }
      }
    ];
    
    // Функція для виклику випадкової події
    function triggerRandomEvent() {
      // 15% шанс події при кожній дії
      if (Math.random() < 0.15) {
        const randomEvent = events[Math.floor(Math.random() * events.length)];
        showNotification(randomEvent.description);
        randomEvent.effect();
        saveUserData();
      }
    }

    function openInventory() {
      document.getElementById('inventory-modal').style.display = 'flex';
      renderInventoryModal();
    }

    function closeInventory() {
      document.getElementById('inventory-modal').style.display = 'none';
    }

    function renderInventoryModal() {
      const list = document.getElementById('inventory-modal-list');
      const countSpan = document.getElementById('inventory-count');
      list.innerHTML = '';
      
      console.log('renderInventoryModal - поточний інвентар:', inventory);
      console.log('renderInventoryModal - itemData:', itemData);
      
      let totalItems = 0;
      
      // Підраховуємо загальну кількість предметів в інвентарі
      Object.keys(inventory).forEach(item => {
        totalItems += inventory[item];
      });
      
      countSpan.innerText = `Предметів: ${totalItems}`;
      
      // Показуємо всі предмети з itemData
      const allItems = itemData.map(item => item.name);
      
      if (allItems.length === 0) {
        const li = document.createElement('li');
        li.innerText = 'Інвентар порожній';
        li.style.textAlign = 'center';
        li.style.color = 'var(--text-soft)';
        li.style.padding = '40px 20px';
        li.style.fontSize = '1.1em';
        list.appendChild(li);
      } else {
        allItems.forEach((item) => {
          const data = itemMap[item];
          if (!data) return; // Пропускаємо предмети які не існують в itemMap
          
          const itemCount = inventory[item] || 0;
          
          const li = document.createElement('li');
          li.style.background = 'rgba(255,255,255,0.08)';
          li.style.borderRadius = '16px';
          li.style.padding = '20px';
          li.style.display = 'flex';
          li.style.alignItems = 'center';
          li.style.gap = '16px';
          li.style.border = '1px solid rgba(255,255,255,0.1)';
          
          // Робимо предмет блідим якщо його немає в інвентарі
          if (itemCount === 0) {
            li.style.opacity = '0.5';
          }
          
          if (data.rarity === 'legendary' && equippedLegendaryItems.includes(item)) {
            li.style.border = '2px solid gold';
            li.style.boxShadow = '0 0 16px 0 gold';
          }
          
          const icon = document.createElement('div');
          icon.style.width = '48px';
          icon.style.height = '48px';
          icon.style.backgroundImage = `url('${data.icon}')`;
          icon.style.backgroundSize = 'contain';
          icon.style.backgroundRepeat = 'no-repeat';
          icon.style.backgroundPosition = 'center';
          icon.style.borderRadius = '8px';
          icon.style.backgroundColor = 'rgba(255,255,255,0.1)';
          
          const info = document.createElement('div');
          info.style.flex = '1';
          info.style.display = 'flex';
          info.style.flexDirection = 'column';
          info.style.gap = '8px';
          
          const nameSpan = document.createElement('span');
          nameSpan.innerText = data.name + (itemCount > 1 ? ` ×${itemCount}` : '') + (itemCount === 0 ? ' (немає)' : '');
          nameSpan.style.fontWeight = '600';
          nameSpan.style.fontSize = '1.1em';
          nameSpan.style.color = 'var(--text-main)';
          
          const raritySpan = document.createElement('span');
          raritySpan.innerText = data.rarity === 'neon' ? 'Неонова' : (data.rarity === 'legendary' ? 'Золота' : (data.rarity === 'epic' ? 'Пурпурна' : 'Камонка'));
          raritySpan.style.fontSize = '0.9em';
          raritySpan.style.color = data.rarity === 'neon' ? '#00fff0' : (data.rarity === 'legendary' ? '#FFD700' : (data.rarity === 'epic' ? '#DA70D6' : '#C0C0C0'));
          
          const priceSpan = document.createElement('span');
          priceSpan.innerText = `${data.price} XP`;
          priceSpan.style.fontSize = '0.9em';
          priceSpan.style.color = 'var(--accent)';
          
          info.appendChild(nameSpan);
          info.appendChild(raritySpan);
          info.appendChild(priceSpan);
          
          const actions = document.createElement('div');
          actions.style.display = 'flex';
          actions.style.flexDirection = 'column';
          actions.style.gap = '8px';
          
          // Показуємо кнопку продажу тільки якщо предмет є в інвентарі
          if (itemCount > 0) {
            const sellBtn = document.createElement('button');
            sellBtn.innerText = 'Продати';
            sellBtn.style.background = 'var(--accent)';
            sellBtn.style.color = '#000';
            sellBtn.style.border = 'none';
            sellBtn.style.borderRadius = '8px';
            sellBtn.style.padding = '8px 16px';
            sellBtn.style.fontSize = '0.9em';
            sellBtn.style.cursor = 'pointer';
            sellBtn.style.fontWeight = '600';
            sellBtn.onclick = function() { 
              confirmSell(item);
              // Оновлюємо інвентар після продажу
              setTimeout(() => {
                renderInventoryModal();
              }, 100);
            };
            
            actions.appendChild(sellBtn);
          }
          
          if (data.rarity === 'legendary' || data.rarity === 'neon') {
            const equipBtn = document.createElement('button');
            const isEquipped = equippedLegendaryItems.includes(item);
            equipBtn.innerText = isEquipped ? 'Зняти' : (itemCount > 0 ? 'Екіпірувати' : 'Екіпірувати (немає)');
            equipBtn.style.background = isEquipped ? '#ff6b6b' : '#4CAF50';
            equipBtn.style.color = '#fff';
            equipBtn.style.border = 'none';
            equipBtn.style.borderRadius = '8px';
            equipBtn.style.padding = '8px 16px';
            equipBtn.style.fontSize = '0.9em';
            equipBtn.style.cursor = (itemCount > 0 && !isEquipped) ? 'pointer' : 'not-allowed';
            equipBtn.style.fontWeight = '600';
            
            if (!isEquipped && (equippedLegendaryItems.length >= 3 || itemCount === 0)) {
              equipBtn.disabled = true;
              equipBtn.style.opacity = '0.5';
            }
            
            equipBtn.onclick = function() {
              if (itemCount === 0 && !isEquipped) return; // Не можна екіпірувати предмет якого немає
              
              if (isEquipped) {
                equippedLegendaryItems = equippedLegendaryItems.filter(x => x !== item);
              } else {
                if (equippedLegendaryItems.length < 3) {
                  equippedLegendaryItems.push(item);
                }
              }
              updateInventoryUI();
              updateTrainXPUI();
              saveUserData();
              // Оновлюємо інвентар після екіпірування
              setTimeout(() => {
                renderInventoryModal();
              }, 100);
            };
            
            actions.appendChild(equipBtn);
          }
          
          li.appendChild(icon);
          li.appendChild(info);
          li.appendChild(actions);
          list.appendChild(li);
        });
      }
    }

    // Додатково завантажуємо дані при завантаженні сторінки
    window.addEventListener('DOMContentLoaded', () => {
      loadUserData();
    });

    function updateTrainXPUI() {
      document.getElementById('xp-per-train').innerText = `+${getTrainXP()} XP за тренування`;
    }
  </script>
  <button id="open-case-btn" onclick="explorePet()" title="Відкрити кейс" style="
    position: fixed;
    right: 36px;
    bottom: 36px;
    z-index: 3001;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: linear-gradient(90deg, #00fff0 0%, #a259f7 100%);
    color: #fff;
    border: none;
    box-shadow: 0 0 32px 8px #00fff0, 0 0 64px 16px #a259f7;
    font-size: 2.8em;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    outline: none;
    transition: box-shadow 0.18s, transform 0.13s;
    animation: neon-pulse 1.5s infinite alternate;
  ">
    <span style="display:inline-block; font-size:1.2em;">🔮</span>
  </button>
  <style>
  @keyframes neon-pulse {
    from { box-shadow: 0 0 32px 8px #00fff0, 0 0 64px 16px #a259f7; }
    to { box-shadow: 0 0 64px 16px #00fff0, 0 0 128px 32px #a259f7; }
  }
  @media (max-width: 700px) {
    #open-case-btn {
      right: 12px;
      bottom: 12px;
      width: 60px;
      height: 60px;
      font-size: 1.6em;
    }
  }
  </style>
  <!-- Додаю кастомний tooltip для кнопки відкриття кейсу -->
  <div id="open-case-tooltip" style="
    display:none;
    position:fixed;
    z-index:4000;
    background:rgba(0,0,0,0.92);
    color:#fff;
    padding:14px 22px;
    border-radius:14px;
    font-size:1.1em;
    font-weight:600;
    pointer-events:none;
    box-shadow:0 0 24px 4px #00fff0, 0 0 8px 2px #a259f7;
    text-shadow:0 0 8px #00fff0, 0 0 2px #fff;
    transition:opacity 0.2s;
    opacity:0;
  "></div>
  <script>
  const openCaseBtn = document.getElementById('open-case-btn');
  const openCaseTooltip = document.getElementById('open-case-tooltip');
  if (openCaseBtn && openCaseTooltip) {
    openCaseBtn.addEventListener('mouseenter', function(e) {
      let price = isGalaxyEquipped() ? 'Безкоштовно (з Galaxy)' : '10000 XP';
      openCaseTooltip.innerHTML = `<span style='font-size:1.2em;'>🔮</span> Відкрити кейс<br><span style='color:#00fff0;'>${price}</span>`;
      openCaseTooltip.style.display = 'block';
      openCaseTooltip.style.opacity = '1';
      const rect = openCaseBtn.getBoundingClientRect();
      openCaseTooltip.style.left = (rect.left + rect.width/2 - openCaseTooltip.offsetWidth/2) + 'px';
      openCaseTooltip.style.top = (rect.top - openCaseTooltip.offsetHeight - 18) + 'px';
    });
    openCaseBtn.addEventListener('mousemove', function(e) {
      const rect = openCaseBtn.getBoundingClientRect();
      openCaseTooltip.style.left = (rect.left + rect.width/2 - openCaseTooltip.offsetWidth/2) + 'px';
      openCaseTooltip.style.top = (rect.top - openCaseTooltip.offsetHeight - 18) + 'px';
    });
    openCaseBtn.addEventListener('mouseleave', function() {
      openCaseTooltip.style.opacity = '0';
      setTimeout(()=>{ openCaseTooltip.style.display = 'none'; }, 200);
    });
  }
  </script>
</body>
</html>